"use strict";angular.module("commonServices",[]),angular.module("common",["ngResource","my.resource","default","xml","hl7v2-edi","hl7v2","edi"]),angular.module("soap",["common"]),angular.module("cf",["common"]),angular.module("doc",["common"]),angular.module("cb",["common"]),angular.module("envelope",["soap"]),angular.module("connectivity",["soap"]),angular.module("isolated",["common"]),angular.module("hit-tool-directives",[]),angular.module("hit-tool-services",["common"]),angular.module("documentation",[]);var app=angular.module("tool",["ngRoute","ui.bootstrap","ngCookies","LocalStorageModule","ngResource","ngSanitize","ngAnimate","ui.bootstrap","angularBootstrapNavTree","QuickList","format","soap","default","hl7v2-edi","xml","hl7v2","edi","envelope","connectivity","cf","cb","isolated","ngTreetable","blueimp.fileupload","hit-tool-directives","hit-tool-services","commonServices","smart-table","doc","hit-profile-viewer","hit-validation-result","hit-vocab-search","hit-report-viewer","hit-testcase-viewer","hit-testcase-tree","hit-doc","hit-dqa","documentation"]);app.config(["$routeProvider","$httpProvider","localStorageServiceProvider",function(a,b,c){c.setPrefix("hit-tool").setStorageType("sessionStorage"),a.when("/",{templateUrl:"views/home.html"}).when("/home",{templateUrl:"views/home.html"}).when("/doc",{templateUrl:"views/doc.html"}).when("/setting",{templateUrl:"views/setting.html"}).when("/about",{templateUrl:"views/about.html"}).when("/contact",{templateUrl:"views/contact.html"}).when("/soapEnv",{templateUrl:"views/envelope/testing.html"}).when("/soapConn",{templateUrl:"views/connectivity/testing.html"}).when("/cf",{templateUrl:"views/cf/testing.html"}).when("/is",{templateUrl:"views/isolated/testing.html"}).when("/cb",{templateUrl:"views/cb/testing.html"}).otherwise({redirectTo:"/"})}]),app.run(["$rootScope","$location","$modal","TestingSettings","AppInfo","$q","$sce","$templateCache","$compile","StorageService","$window","$route",function(a,b,c,d,e,f,g,h,i,j,k,l){a.appInfo={},a.stackPosition=0,a.scrollbarWidth=null,(new e).then(function(b){a.appInfo=b},function(){a.appInfo={}}),a.$watch(function(){return b.path()},function(b){if(a.activePath===b){var c,d=k.history.state;c=!!(d&&d.position<=a.stackPosition),c?a.stackPosition--:a.stackPosition++}else l.current&&(k.history.replaceState({position:a.stackPosition},""),a.stackPosition++)}),a.isActive=function(b){return b===a.activePath},a.setActive=function(c){""===c||"/"===c?b.path("/home"):a.activePath=c},a.isSubActive=function(b){return b===a.subActivePath},a.setSubActive=function(b){a.subActivePath=b,j.set(j.ACTIVE_SUB_TAB_KEY,b)},a.showError=function(b){var d=c.open({templateUrl:"ErrorDlgDetails.html",controller:"ErrorDetailsCtrl",resolve:{error:function(){return b}}});d.result.then(function(b){a.error=b},function(){})},a.cutString=function(a){return a.length>20&&(a=a.substring(0,20)+"..."),a},a.toHTML=function(a){return g.trustAsHtml(a)},a.selectTestingType=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.tabs[4]=!1,a.tabs[5]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0,d.setActiveTab(a.activeTab)},a.initAppInfo=function(){var b=f.defer();return null===a.appInfo?(new e).then(function(c){return a.appInfo=c,b.resolve(a.appInfo),b.promise}):(b.resolve(a.appInfo),b.promise)},a.downloadArtifact=function(a){var b=document.createElement("form");b.action="api/testartifact/download",b.method="POST",b.target="_target";var c=document.createElement("input");c.name="path",c.value=a,b.appendChild(c),b.style.display="none",document.body.appendChild(b),b.submit()},a.tabs=new Array,a.compile=function(a){return i(a)},a.$on("$locationChangeSuccess",function(){a.setActive(b.path())}),a.getScrollbarWidth=function(){if(null==a.scrollbarWidth){var b=document.createElement("div");b.style.visibility="hidden",b.style.width="100px",b.style.msOverflowStyle="scrollbar",document.body.appendChild(b);var c=b.offsetWidth;b.style.overflow="scroll";var d=document.createElement("div");d.style.width="100%",b.appendChild(d);var e=d.offsetWidth;b.parentNode.removeChild(b),a.scrollbarWidth=c-e}return a.scrollbarWidth},a.openValidationResultInfo=function(){c.open({templateUrl:"ValidationResultInfo.html",windowClass:"profile-modal",controller:"ValidationResultInfoCtrl"})}}]),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(){}]).directive("carousel",[function(){return{}}]),angular.module("hit-tool-services").factory("TabSettings",["$rootScope",function(){return{"new":function(a){return{key:a,activeTab:0,getActiveTab:function(){return this.activeTab},setActiveTab:function(a){this.activeTab=a,this.save()},save:function(){sessionStorage.setItem(this.key,this.activeTab)},restore:function(){this.activeTab=null!=sessionStorage.getItem(this.key)&&""!=sessionStorage.getItem(this.key)?parseInt(sessionStorage.getItem(this.key)):0}}}}}]),app.controller("ErrorDetailsCtrl",["$scope","$modalInstance","error",function(a,b,c){a.error=c,a.ok=function(){b.close(a.error)},a.cancel=function(){b.dismiss("cancel")}}]),app.directive("stRatio",function(){return{link:function(a,b,c){var d=+c.stRatio;b.css("width",d+"%")}}}),angular.module("commonServices").factory("Clock",["$interval",function(a){var b=function(a){this.value=void 0,this.intervl=a};return b.prototype.start=function(b){angular.isDefined(this.value)&&this.stop(),this.value=a(b,this.intervl)},b.prototype.stop=function(){angular.isDefined(this.value)&&(a.cancel(this.value),this.value=void 0)},b}]),angular.module("hit-tool-services").factory("AppInfo",["$http","$q",function(a,b){return function(){var c=b.defer();return a.get("api/appInfo").then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),app.controller("TableFoundCtrl",["$scope","$modalInstance","table",function(a,b,c){a.table=c,a.tmpTableElements=[].concat(null!=c?c.valueSetElements:[]),a.cancel=function(){b.dismiss("cancel")}}]),app.controller("ValidationResultInfoCtrl",["$scope","$modalInstance",function(a,b){a.close=function(){b.dismiss("cancel")}}]),angular.module("my.resource",["ngResource"]).factory("Resource",["$resource",function(a){return function(b,c,d){var e={update:{method:"put",isArray:!1},create:{method:"post"}};d=angular.extend(e,d);var f=a(b,c,d);return f.prototype.$save=function(a,b){return this.id?this.$update(a,b):this.$create(a,b)},f}}]),angular.module("hit-tool-services").factory("TestingSettings",["$rootScope",function(){var a={activeTab:0,getActiveTab:function(){return a.activeTab},setActiveTab:function(b){a.activeTab=b,a.save()},save:function(){sessionStorage.TestingActiveTab=a.activeTab},restore:function(){a.activeTab=null!=sessionStorage.TestingActiveTab&&""!=sessionStorage.TestingActiveTab?parseInt(sessionStorage.TestingActiveTab):0}};return a}]),angular.module("soap",[]),angular.module("soap").factory("SoapValidationReportGenerator",["$http","$q",function(a,b){return function(c,d){var e=b.defer();return a({url:"api/soap/report/generate/"+d,data:$.param({xmlReport:c}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){e.resolve(angular.fromJson(a))}).error(function(a){e.reject(a)}),e.promise}}]),angular.module("soap").factory("SoapValidationReportDownloader",["$http","$q",function(){return{downloadAs:function(a,b){var c=document.createElement("form");c.action="api/soap/report/download/"+b,c.method="POST",c.target="_target";var d=document.createElement("textarea");d.name="xmlReport",d.value=a,c.appendChild(d),c.style.display="none",document.body.appendChild(c),c.submit()}}}]),angular.module("soap").factory("XmlParser",["$http","$q",function(a,b){return function(c){var d=b.defer(),e=angular.fromJson({content:c});return a.post("api/xmlgeneric/parse",e,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise}}]),angular.module("soap").factory("XmlEscaper",[function(){var a={encodeXml:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},decodeXml:function(a){return a.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")}};return a}]),angular.module("soap").factory("XmlFormatter",["$http","$q",function(a,b){return function(c){var d=b.defer(),e=angular.fromJson({content:c});return a.post("api/xmlgeneric/format",e,{timeout:6e4}).then(function(a){d.resolve(a.data.content)},function(a){d.reject(a.data)}),d.promise}}]),angular.module("soap").factory("XmlNodeFinder",["$rootScope",function(){return{find:function(a,b){var c=a.get_first_branch(),d=a.get_siblings(c);if(d){var e=d[0];return null==e?null:this.findNode(a,e,b.line)}return null},findNode:function(a,b,c){if(b.data.start.line<=c){if(b.data.start.line==c||b.data.end.line==c)return b;var d=a.get_children(b);if(d&&d.length>0)for(var e=0;e<d.length;e++){var f=this.findNode(a,d[e],c);if(null!=f)return f}}return null}}}]),angular.module("soap").factory("XmlCursorUtils",["$rootScope",function(){return{createCoordinate:function(a,b){try{return angular.fromJson({start:a,end:b})}catch(c){}}}}]),angular.module("soap").factory("XmlEditorUtils",["$rootScope","$http","$q",function(){return{select:function(a,b){b.doc.setSelection({line:a.start.line-1,ch:a.start.index},{line:a.end.line-1,ch:a.end.index})},isXML:function(a){return a.startsWith("<")}}}]),angular.module("soap").factory("XmlTreeUtils",["$rootScope","$http","$q","XmlNodeFinder","XmlCursorUtils",function(a,b,c,d,e){return{selectNode:function(a,b){var c=d.find(a,b);if(null!==c){var e=a.get_selected_branch();e!==c&&(a.collapse_all(),a.select_branch(c),a.expand_branch(c),b.start=c.data.start,b.end=c.data.end)}},getCoordinate:function(a){return e.createCoordinate(a.data.start,a.data.end)},setCoordinate:function(a,b){try{var c=this.getCoordinate(a);null!==c&&(b.start=c.start,b.end=c.end,b.notify())}catch(d){}},expandTree:function(a){if(a){var b=a.get_first_branch(),c=a.get_siblings(b);if(c)for(var d=0;d<c.length;d++){var e=c[d];a.expand_branch(e);for(var f=a.get_children(e),g=0;g<f.length;g++){var h=f[g];a.expand_branch(h);for(var i=a.get_children(h),j=0;j<i.length;j++){var k=i[j];a.expand_branch(k)}}}}}}}]),angular.module("envelope").factory("Envelope",["$http","$q","XmlEditor","XmlCursor","ValidationResult","EnvelopeReport","Message","ValidationSettings",function(a,b,c,d,e,f,g,h){var i={testCase:null,selectedTestCase:null,editor:new c,cursor:new d,validationResult:new e,message:new g,report:new f,validationSettings:new h,getContent:function(){return i.message.content}};return i}]),angular.module("envelope").factory("EnvelopeReport",["$http","Report",function(a,b){var c=function(){b.call(this,arguments)};return c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.generateByFormat=function(a,b){return this.generate("api/envelope/report/generate/"+b,a)},c.prototype.downloadByFormat=function(a,b){return this.generate("api/envelope/report/download/"+b,a)},c}]),angular.module("envelope").factory("EnvelopeTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/envelope/testcases/",{timeout:6e4}).then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("envelope").factory("EnvelopeValidator",["$http","$q","XmlEditorUtils",function(a,b,c){var d=function(){};return d.prototype.validate=function(d,e){var f=b.defer();if(c.isXML(d)){var g=angular.fromJson({content:d});a.post("api/envelope/testcases/"+e+"/validate",g,{timeout:6e4}).then(function(a){f.resolve(angular.fromJson(a.data))},function(a){f.reject(a.data)})}else f.reject("Message provided is not an xml message");return f.promise},d}]),angular.module("cf").factory("CF",["$rootScope","$http","$q","Editor","EDICursor","Er7Message","Tree",function(a,b,c,d,e,f,g){var h={editor:new d,cursor:new e,tree:new g,dqaValidationResult:null,testCase:null,selectedTestCase:null,message:new f,searchTableId:0};return h}]),angular.module("cf").factory("CFTestCaseListLoader",["$q","$http","StorageService","$timeout",function(a,b){return function(){var c=a.defer();return b.get("api/cf/testcases").then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("cb").factory("CB",["$http","$q","Editor","EDICursor","Er7Message","ValidationSettings","Tree",function(a,b,c,d,e,f,g){var h={testCase:null,selectedTestCase:null,editor:new c,tree:new g,cursor:new d,message:new e,validationSettings:new f,setContent:function(a){h.message.content=a,h.editor.instance.doc.setValue(a),h.message.notifyChange()},getContent:function(){return h.message.content}};return h}]),angular.module("cb").factory("CBTestCaseListLoader",["$q","$http","StorageService","$timeout",function(a,b){return function(){var c=a.defer();return b.get("api/cb/testcases").then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("connectivity").factory("Connectivity",["$rootScope","$http","$q","ConnectivityPart","Logger","Endpoint","TransactionUser","StorageService",function(a,b,c,d,e,f,g,h){var i=function(){var a=new g;return a.receiverUsername=h.get(h.SOAP_COMM_RECEIVER_USERNAME_KEY),a.receiverPassword=h.get(h.SOAP_COMM_RECEIVER_PWD_KEY),a.receiverFacilityId=h.get(h.SOAP_COMM_RECEIVER_FACILITYID_KEY),a.receiverEndpoint=h.get(h.SOAP_COMM_RECEIVER_ENDPOINT_KEY),a},j={testCase:null,selectedTestCase:null,logger:new e,request:new d,response:new d,user:i()};return j}]),angular.module("connectivity").factory("ConnectivityTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/connectivity/testcases",{timeout:6e4}).then(function(a){c.resolve(angular.fromJson(a.data))},function(){c.reject("Sorry, failed to fetch the test cases. Please refresh your page.")}),c.promise}}]),angular.module("connectivity").factory("ConnectivityInitiator",["$q","$http",function(a,b){var c=function(){};return c.prototype.send=function(c,d,e){var f=a.defer(),g=angular.fromJson({testCaseId:d,content:e,endpoint:c.receiverEndpoint,u:c.receiverUsername,p:c.receiverPassword,facilityId:c.receiverFacilityId});return b.post("api/connectivity/send",g,{timeout:6e4}).then(function(a){f.resolve(angular.fromJson(a.data))},function(a){f.reject(a)}),f.promise},c}]),angular.module("connectivity").factory("ConnectivityValidator",["$q","$http","XmlEditorUtils",function(a,b,c){var d=function(){};return d.prototype.validate=function(d,e,f,g,h){var i=a.defer();if(c.isXML(d)){var j=angular.fromJson({content:d,testCaseId:e,userId:f,type:g,requestMessage:h});b.post("api/connectivity/validate",j,{timeout:6e4}).then(function(a){i.resolve(angular.fromJson(a.data))},function(a){i.reject(a.data)})}else i.reject("Message provided is not an xml message");return i.promise},d}]),angular.module("connectivity").factory("ConnectivityPart",["$rootScope","$http","$q","Editor","XmlCursor","ValidationResult","ConnectivityReport","Message","ValidationSettings",function(a,b,c,d,e,f,g,h,i){var j=function(){this.editor=new d,this.cursor=new e,this.validationResult=new f,this.message=new h,this.report=new g,this.validationSettings=new i};return j.prototype.setContent=function(a){this.editor.instance.doc.setValue(a)},j.prototype.formatContent=function(){this.editor.format()},j.prototype.getContent=function(){return this.message.content},j}]),angular.module("connectivity").factory("ConnectivityReport",["$http","Report",function(a,b){var c=function(){b.call(this,arguments)};return c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.generateByFormat=function(a,b){return this.generate("api/connectivity/report/generate/"+b,a)},c.prototype.downloadByFormat=function(a,b){return this.generate("api/connectivity/report/download/"+b,a)},c}]),angular.module("connectivity").factory("ConnectivityClock",["$interval","Clock",function(a,b){return new b(1e3)}]),angular.module("isolated").factory("IsolatedSystem",["$http","$q","Editor","EDICursor","Er7Message","ValidationSettings","Tree","TransactionUser","$rootScope","Logger","StorageService",function(a,b,c,d,e,f,g,h,i,j,k){var l=function(){var a=new h;return a.receiverUsername=k.get(k.SOAP_COMM_RECEIVER_USERNAME_KEY),a.receiverPassword=k.get(k.SOAP_COMM_RECEIVER_PWD_KEY),a.receiverFacilityId=k.get(k.SOAP_COMM_RECEIVER_FACILITYID_KEY),a.receiverEndpoint=k.get(k.SOAP_COMM_RECEIVER_ENDPOINT_KEY),a},m={testCase:null,testStep:null,selectedTestCase:null,editor:new c,tree:new g,cursor:new d,message:new e,validationSettings:new f,logger:new j,user:l(),setContent:function(a){m.message.content=a,m.editor.instance.doc.setValue(a),m.message.notifyChange()},getContent:function(){return m.message.content}};return m}]),angular.module("isolated").factory("IsolatedSystemTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/isolated/testcases").then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("isolated").factory("IsolatedSystemInitiator",["$q","$http",function(a,b){var c=function(){};return c.prototype.send=function(c,d,e){var f=a.defer(),g=angular.fromJson({testCaseId:d,content:e,endpoint:c.receiverEndpoint,u:c.receiverUsername,p:c.receiverPassword,facilityId:c.receiverFacilityId});return b.post("api/isolated/soap/send",g,{timeout:6e4}).then(function(a){f.resolve(angular.fromJson(a.data))},function(a){f.reject(a)}),f.promise},c}]),angular.module("isolated").factory("IsolatedExecutionService",["$q","$http",function(){var a=function(){};return a.setExecutionStatus=function(a,b){null!=a&&(a.executionStatus=b)},a.getExecutionStatus=function(a){return null!=a?a.executionStatus:void 0},a.getValidationStatus=function(a){return null!=a&&a.validationReport&&a.validationReport.result&&a.validationReport.result.errors&&a.validationReport.result.errors.categories[0]&&a.validationReport.result.errors.categories[0].data?a.validationReport.result.errors.categories[0].data.length:-1},a.getValidationResult=function(a){return null!=a&&a.validationReport?a.validationReport.result:void 0},a.setExecutionMessage=function(a,b){null!=a&&(a.executionMessage=b)},a.getExecutionMessage=function(a){return null!=a?a.executionMessage:void 0},a.setMessageTree=function(a,b){null!=a&&(a.messageTree=b)},a.getMessageTree=function(a){return null!=a?a.messageTree:void 0},a.getValidationReport=function(a){return null!=a?a.validationReport:void 0},a.setValidationReport=function(a,b){a.validationReport=b},a.deleteExecutionStatus=function(a){null!=a&&delete a.executionStatus},a.deleteValidationReport=function(a){a&&a.validationReport&&delete a.validationReport},a.deleteExecutionMessage=function(a){a&&a.executionMessage&&delete a.executionMessage},a.deleteMessageTree=function(a){a&&a.messageTree&&delete a.messageTree},a}]),angular.module("isolated").factory("IsolatedSystemClock",["$interval","Clock",function(a,b){return new b(1e3)}]),angular.module("commonServices").factory("Editor",["$http","$q",function(){var a=function(){this.instance=null,this.updateIndicator="0",this.id=null,this.name=""};return a.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},a.prototype.init=function(a){void 0!=a&&(this.instance=a)},a.prototype.getContent=function(){return void 0!=this.instance?this.instance.doc.getValue():null},a.prototype.setContent=function(a){void 0!=this.instance&&(this.instance.doc.setValue(a),this.notifyChange())},a}]),angular.module("commonServices").factory("XmlEditor",["Editor",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.format=function(){this.instance.doc.setValue(this.instance.doc.getValue().replace(/\n/g,"").replace(/[\t ]+\</g,"<").replace(/\>[\t ]+\</g,"><").replace(/\>[\t ]+$/g,">"));var a=this.instance.lineCount(),b=this.instance.getTextArea().value.length;this.instance.autoFormatRange({line:0,ch:0},{line:a,ch:b})},b}]),angular.module("commonServices").factory("EDICursor",function(){var a=function(){this.line=1,this.startIndex=-1,this.endIndex=-1,this.index=-1,this.segment="",this.updateIndicator="0",this.triggerTree=void 0};return a.prototype.init=function(a,b,c,d,e){this.line=a,this.startIndex=b,this.endIndex=c,this.index=d,this.triggerTree=e,this.notify()},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("XmlCursor",function(){var a=function(){this.line=-1,this.start={line:1,index:-1},this.end={line:1,index:-1},this.updateIndicator="0"};return a.prototype.setLine=function(a){this.line=a,this.notify()},a.prototype.toString=function(){return this.line+","+this.start+","+this.end},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("ValidationResultItem",function(){var a=function(){this.data=[],this.categories=[],this.categories.push({title:"All",data:[]}),this.show=!0,this.updateIndicator="0"};return a.prototype.init=function(a){this.data=a,this.categories=[],this.categories.push({title:"All",data:[]}),this.show=!0,this.notify()},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("ValidationSettings",function(){var a=function(){this.errors=!0,this.affirmatives=!0,this.ignores=!0,this.alerts=!0,this.warnings=!0};return a}),angular.module("commonServices").factory("ValidationResult",["ValidationResultItem","$q",function(a){var b=function(b){this.key=b,this.xml="",this.errors=new a,this.affirmatives=new a,this.ignores=new a,this.alerts=new a,this.warnings=new a,this.informationals=new a,this.id=""};return b.prototype.updateId=function(){this.id=(new Date).getTime()},b.prototype.clear=function(){this.xml="",this.errors=new a,this.affirmatives=new a,this.ignores=new a,this.alerts=new a,this.warnings=new a,this.informationals=new a,this.updateId()},b.prototype.init=function(a){this.xml=a.xml,this.errors.init(a.errors),this.affirmatives.init(a.affirmatives),this.ignores.init(a.ignores),this.alerts.init(a.alerts),this.warnings.init(a.warnings),this.informationals.init(a.informationals),this.updateId()},b.prototype.saveState=function(){sessionStorage.setItem(this.key,this.content)},b.prototype.restoreState=function(){this.content=sessionStorage.getItem(this.key)},b.prototype.hasState=function(){return sessionStorage.getItem(this.key)!=={xml:""}&&null!=sessionStorage.getItem(this.key)},b.prototype.getState=function(){return sessionStorage.getItem(this.key)},b.prototype.getContent=function(){return this.content},b.prototype.setContent=function(a){this.content=a},b}]),angular.module("commonServices").factory("DQAValidationResult",function(){var a=function(a){this.errors=[],this.warnings=[];for(var b=0;b<a.issuesList.length;b++){var c=a.issuesList[b];"Error"===c.type?this.errors.push(c):this.warnings.push(c)}};return a}),angular.module("commonServices").factory("Profile",["$http","$q",function(){var a=function(){this.id=null,this.xml="",this.json="",this.name=[],this.description=""};return a.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},a.prototype.init=function(a){this.id=a.id,this.xml=a.xml,this.json=null,this.name=a.name,this.description=a.description},a.prototype.clear=function(){this.id=null,this.xml=null,this.json=null,this.name=null,this.description=null},a}]),angular.module("commonServices").factory("Message",["$http","$q",function(){var a=function(){this.id=null,this.name="",this.content="",this.description="",this.updateIndicator="0"};return a.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},a.prototype.setContent=function(a){this.content=void 0!=a?a:"",this.notifyChange()},a.prototype.init=function(a){this.id=a.id,this.name=a.name,this.description=a.description,this.setContent(a.content)},a.prototype.download=function(){var a=document.createElement("form");a.action="api/message/download",a.method="POST",a.target="_target";var b=document.createElement("textarea");b.name="content",b.value=this.content,a.appendChild(b),a.style.display="none",document.body.appendChild(a),a.submit()},a}]),angular.module("commonServices").factory("Tree",function(){var a=function(){this.id=null,this.root={}};return a}),angular.module("commonServices").factory("TestCaseService",["$filter",function(a){var b=function(){};return b.prototype.findOneById=function(a,b){if(b){if(a===b.id)return b;if(b.children&&null!=b.children&&b.children.length>0)for(var c=0;c<b.children.length;c++){var d=this.findOneById(a,b.children[c]);if(null!=d)return d}}return null},b.prototype.findOneByIdAndType=function(a,b,c){if(c){if(a===c.id&&b===c.type)return c;if(c.children&&null!=c.children&&c.children.length>0)for(var d=0;d<c.children.length;d++){var e=this.findOneByIdAndType(a,b,c.children[d]);if(null!=e)return e}}return null},b.prototype.buildTree=function(b){b.label="TestStep"===b.type?b.position+"."+b.name:b.name,b.nav||(b.nav={});var c=this;b.testCases&&(b.children?angular.forEach(b.testCases,function(a){b.children.push(a),a.nav={},a.nav.testStep=null,a.nav.testCase=a.name,a.nav.testPlan="TestPlan"===b.type?b.name:b.nav.testPlan,a.nav.testGroup="TestCaseGroup"===b.type?b.name:b.nav.testGroup,c.buildTree(a)}):(b.children=b.testCases,angular.forEach(b.children,function(a){a.nav={},a.nav.testStep=null,a.nav={},a.nav.testCase=a.name,a.nav.testPlan="TestPlan"===b.type?b.name:b.nav.testPlan,a.nav.testGroup="TestCaseGroup"===b.type?b.name:b.nav.testGroup,c.buildTree(a)})),b.children=a("orderBy")(b.children,"position"),delete b.testCases),b.testCaseGroups&&(b.children?angular.forEach(b.testCaseGroups,function(a){b.children.push(a),a.nav={},a.nav.testCase=null,a.nav.testStep=null,a.nav.testPlan="TestPlan"===b.type?b.name:b.nav.testPlan,a.nav.testGroup="TestCaseGroup"===b.type?b.name:b.nav.testGroup,c.buildTree(a)}):(b.children=b.testCaseGroups,angular.forEach(b.children,function(a){a.nav={},a.nav.testCase=null,a.nav.testStep=null,a.nav.testPlan="TestPlan"===b.type?b.name:b.nav.testPlan,a.nav.testGroup="TestCaseGroup"===b.type?b.name:b.nav.testGroup,c.buildTree(a)})),b.children=a("orderBy")(b.children,"position"),delete b.testCaseGroups),b.testSteps&&(b.children?angular.forEach(b.testSteps,function(a){b.children.push(a),a.nav={},a.nav.testCase=b.name,a.nav.testStep=a.position+"."+a.name,a.nav.testPlan=b.nav.testPlan,a.nav.testGroup=b.nav.testGroup,c.buildTree(a)}):(b.children=b.testSteps,angular.forEach(b.children,function(a){a.nav={},a.nav.testCase=b.name,a.nav.testStep=a.position+"."+a.name,a.nav.testPlan=b.nav.testPlan,a.nav.testGroup=b.nav.testGroup,c.buildTree(a)})),b.children=a("orderBy")(b.children,"position"),delete b.testSteps)},b.prototype.buildCFTestCases=function(b){if(b.label=b.children?b.name:b.position+"."+b.name,b.nav={},b.nav.testStep=b.label,b.nav.testCase=null,b.nav.testPlan=null,b.nav.testGroup=null,b.children){var c=this;b.children=a("orderBy")(b.children,"position"),angular.forEach(b.children,function(a){a.nav={},a.nav.testStep=a.label,a.nav.testCase=b.label,a.nav.testPlan=b.nav.testPlan,a.nav.testGroup=null,c.buildCFTestCases(a)})}},b.prototype.findNode=function(a,b,c,d){if(b.id===c&&(void 0!=d&&b.type===d||!d&&!b.type))return b;var e=a.get_children(b);if(e&&e.length>0)for(var f=0;f<e.length;f++){var g=this.findNode(a,e[f],c,d);if(null!=g)return g}return null},b.prototype.selectNodeByIdAndType=function(a,b,c){if(null!=b&&null!=a){var d=null,e=a.get_first_branch(),f=a.get_siblings(e);if(f&&f.length>0)for(var g=0;g<f.length;g++){var h=this.findNode(a,f[g],b,c);if(null!=h){d=h;break}}null!=d&&(a.collapse_all(),a.select_branch(d),a.expand_branch(d))}},b}]),angular.module("commonServices").factory("StorageService",["$rootScope","localStorageService",function(a,b){var c={CF_EDITOR_CONTENT_KEY:"CF_EDITOR_CONTENT",CF_LOADED_TESTCASE_ID_KEY:"CF_LOADED_TESTCASE_ID",CF_LOADED_TESTCASE_TYPE_KEY:"CF_LOADED_TESTCASE_TYPE",CB_EDITOR_CONTENT_KEY:"CB_EDITOR_CONTENT",CB_SELECTED_TESTCASE_ID_KEY:"CB_SELECTED_TESTCASE_ID",CB_SELECTED_TESTCASE_TYPE_KEY:"CB_SELECTED_TESTCASE_TYPE",CB_LOADED_TESTCASE_ID_KEY:"CB_LOADED_TESTCASE_ID",CB_LOADED_TESTCASE_TYPE_KEY:"CB_LOADED_TESTCASE_TYPE",ISOLATED_EDITOR_CONTENT_KEY:"ISOLATED_EDITOR_CONTENT",ISOLATED_SELECTED_TESTCASE_ID_KEY:"ISOLATED_SELECTED_TESTCASE_ID",ISOLATED_LOADED_TESTCASE_ID_KEY:"ISOLATED_LOADED_TESTCASE_ID",ISOLATED_LOADED_TESTSTEP_ID_KEY:"ISOLATED_LOADED_TESTSTEP_ID",ISOLATED_LOADED_TESTSTEP_TYPE_KEY:"ISOLATED_LOADED_TESTSTEP_TYPE",ISOLATED_SELECTED_TESTCASE_TYPE_KEY:"ISOLATED_SELECTED_TESTCASE_TYPE",ISOLATED_LOADED_TESTCASE_TYPE_KEY:"ISOLATED_LOADED_TESTCASE_TYPE",SOAP_ENV_EDITOR_CONTENT_KEY:"SOAP_ENV_EDITOR_CONTENT",SOAP_ENV_SELECTED_TESTCASE_ID_KEY:"SOAP_ENV_SELECTED_TESTCASE_ID",SOAP_ENV_SELECTED_TESTCASE_TYPE_KEY:"SOAP_ENV_SELECTED_TESTCASE_TYPE",SOAP_ENV_LOADED_TESTCASE_ID_KEY:"SOAP_ENV_LOADED_TESTCASE_ID",SOAP_ENV_LOADED_TESTCASE_TYPE_KEY:"SOAP_ENV_LOADED_TESTCASE_TYPE",SOAP_CONN_REQ_EDITOR_CONTENT_KEY:"SOAP_CONN_REQ_EDITOR_CONTENT",SOAP_CONN_RESP_EDITOR_CONTENT_KEY:"SOAP_CONN_RESP_EDITOR_CONTENT",SOAP_CONN_SELECTED_TESTCASE_ID_KEY:"SOAP_CONN_SELECTED_TESTCASE_ID",SOAP_CONN_SELECTED_TESTCASE_TYPE_KEY:"SOAP_CONN_SELECTED_TESTCASE_TYPE",SOAP_CONN_LOADED_TESTCASE_ID_KEY:"SOAP_CONN_LOADED_TESTCASE_ID",SOAP_CONN_LOADED_TESTCASE_TYPE_KEY:"SOAP_CONN_LOADED_TESTCASE_TYPE",ACTIVE_SUB_TAB_KEY:"ACTIVE_SUB_TAB",SOAP_COMM_SENDER_USERNAME_KEY:"SOAP_COMM_SENDER_USERNAME",SOAP_COMM_SENDER_PWD_KEY:"SOAP_COMM_SENDER_PWD",SOAP_COMM_SENDER_ENDPOINT_KEY:"SOAP_COMM_SENDER_ENDPOINT",SOAP_COMM_SENDER_FACILITYID_KEY:"SOAP_COMM_SENDER_FACILITYID",SOAP_COMM_RECEIVER_USERNAME_KEY:"SOAP_COMM_RECEIVER_USERNAME",SOAP_COMM_RECEIVER_PWD_KEY:"SOAP_COMM_RECEIVER_PWD",SOAP_COMM_RECEIVER_ENDPOINT_KEY:"SOAP_COMM_RECEIVER_ENDPOINT",SOAP_COMM_RECEIVER_FACILITYID_KEY:"SOAP_COMM_RECEIVER_FACILITYID",DQA_OPTIONS_KEY:"DQA_OPTIONS_KEY",remove:function(a){return b.remove(a)},removeList:function(a,c,d){return b.remove(a,c,d)},clearAll:function(){return b.clearAll()},set:function(a,c){return b.set(a,c)},get:function(a){return b.get(a)}};return c}]),angular.module("commonServices").factory("Er7Message",["$http","$q","Message",function(a,b,c){var d=function(){c.apply(this,arguments)};return d.prototype=Object.create(c.prototype),d.prototype.constructor=d,d}]),angular.module("commonServices").factory("Report",["$http","$q",function(a,b){var c=function(){this.html=null};return c.prototype.generate=function(c,d){var e=b.defer();return a({url:c,data:$.param({xmlReport:d}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){e.resolve(angular.fromJson(a))}).error(function(a){e.reject(a)}),e.promise},c.prototype.download=function(a,b){var c=document.createElement("form");c.action=a,c.method="POST",c.target="_target";var d=document.createElement("textarea");d.name="xmlReport",d.value=b,c.appendChild(d),c.style.display="none",document.body.appendChild(c),c.submit()},c}]),angular.module("commonServices").factory("DataInstanceReport",["$http","NewValidationReport",function(a,b){var c=function(){b.call(this,arguments)};return c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.generateByFormat=function(a,b){return this.generate("api/report/generateAs/"+b,a)},c.prototype.downloadByFormat=function(a,b){return this.generate("api/report/downloadAs/"+b,a)},c}]),angular.module("commonServices").factory("NewValidationReport",["$http","$q",function(a,b){var c=function(){this.content={metaData:{},result:{}}};return c.prototype.download=function(a){var b=document.createElement("form");b.action=a,b.method="POST",b.target="_target";var c=document.createElement("textarea");c.name="jsonReport",c.value=this.content,b.appendChild(c),b.style.display="none",document.body.appendChild(b),b.submit()
},c.prototype.generate=function(c){var d=b.defer();return a({url:c,data:$.param({jsonReport:this.content}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){d.resolve(angular.fromJson(a))}).error(function(a){d.reject(a)}),d.promise},c}]),angular.module("commonServices").factory("Logger",function(){var a=function(){this.content=""};return a.prototype.log=function(a){this.content=this.content+"\n"+this.getCurrentTime()+":"+a},a.prototype.clear=function(){this.content=""},a.prototype.init=function(){this.clear()},a.prototype.getCurrentTime=function(){var a=new Date;return(a.getMonth()+1<10?"0":"")+(a.getMonth()+1)+"/"+(a.getDate()<10?"0":"")+a.getDate()+"/"+a.getFullYear()+" - "+(a.getHours()<10?"0":"")+a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes()+":"+(a.getSeconds()<10?"0":"")+a.getSeconds()},a}),angular.module("commonServices").factory("Endpoint",function(){var a=function(){this.value=null},a=function(a){this.value=a};return a}),angular.module("commonServices").factory("SecurityFaultCredentials",["$q","$http",function(){var a=function(){this.username=null,this.password=null};return a.prototype.init=function(a,b){this.username=a,this.password=b},a}]),angular.module("commonServices").factory("Clock",["$interval",function(a){var b=function(a){this.value=void 0,this.intervl=a};return b.prototype.start=function(b){angular.isDefined(this.value)&&this.stop(),this.value=a(b,this.intervl)},b.prototype.stop=function(){angular.isDefined(this.value)&&(a.cancel(this.value),this.value=void 0)},b}]),angular.module("commonServices").factory("TransactionUser",["Endpoint","Transaction","$q","$http",function(a,b,c,d){var e=function(){this.id=null,this.senderUsername=null,this.senderPassword=null,this.senderFacilityID=null,this.receiverUsername=null,this.receiverPassword=null,this.receiverFacilityId=null,this.receiverEndpoint=null,this.endpoint=new a,this.transaction=new b};return e.prototype.init=function(){var b=c.defer(),e=this,f=angular.fromJson({id:e.id});return d.post("api/transaction/initUser",f).then(function(c){var d=angular.fromJson(c.data);e.id=d.id,e.senderUsername=d.username,e.senderPassword=d.password,e.senderFacilityID=d.facilityID,e.endpoint=new a(d.endpoint),e.transaction.init(e.senderUsername,e.senderPassword,e.senderFacilityID),b.resolve(!0)},function(a){b.reject(a)}),b.promise},e}]),angular.module("commonServices").factory("Transaction",["$q","$http",function(a,b){var c=function(){this.username=null,this.running=!1,this.password=null,this.facilityID=null,this.incoming=null,this.outgoing=null};return c.prototype.messages=function(){var c=a.defer(),d=this,e=angular.fromJson({username:d.username,password:d.password,facilityID:d.facilityID});return b.post("api/transaction",e).then(function(a){var b=angular.fromJson(a.data);d.incoming=b.incoming,d.outgoing=b.outgoing,c.resolve(b)},function(){c.reject(null)}),c.promise},c.prototype.init=function(a,b,c){this.clearMessages(),this.username=a,this.password=b,this.facilityID=c},c.prototype.clearMessages=function(){this.incoming=null,this.outgoing=null},c.prototype.closeConnection=function(){var c=this,d=a.defer(),e=angular.fromJson({username:c.username,password:c.password,facilityID:c.facilityID});return b.post("api/transaction/close",e).then(function(){c.running=!0,c.clearMessages(),d.resolve(!0)},function(){c.running=!1,d.reject(null)}),d.promise},c.prototype.openConnection=function(c){var d=this,e=a.defer(),f=angular.fromJson({username:d.username,password:d.password,facilityID:d.facilityID,responseMessageId:c});return b.post("api/transaction/open",f).then(function(){d.running=!0,d.clearMessages(),e.resolve(!0)},function(){d.running=!1,e.reject(null)}),e.promise},c}]),angular.module("tool").controller("MainCtrl",["$scope","$rootScope",function(){}]),angular.module("tool").controller("TestingCtrl",["$scope","$q","$rootScope","TestingSettings",function(a,b,c,d){a.loading=!1,a.init=function(){d.restore(),c.selectTestingType(d.getActiveTab())}}]),angular.module("tool").controller("ValidationResultDetailsCtrl",["$scope","$modalInstance","selectedElement",function(a,b,c){a.selectedElement=c,a.ok=function(){b.close(a.selectedElement)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("cf").controller("CFTestingCtrl",["$scope","$http","CF","$window","$modal","$filter","$rootScope","CFTestCaseListLoader","$timeout","StorageService","TestCaseService",function(a,b,c,d,e,f,g,h,i,j,k){a.cf=c,a.loading=!1,a.loadingTC=!1,a.error=null,a.testCases=[],a.testCase=null,a.tree={},a.tabs=new Array,a.error=null;var l=new k;a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0,0==a.activeTab&&a.$broadcast("cf:refreshEditor")},a.getTestCaseDisplayName=function(a){return a.parentName+" - "+a.label},a.selectTestCase=function(b){a.loadingTC=!0,i(function(){if(b.testContext&&null!=b.testContext){c.testCase=b,a.testCase=c.testCase;var d=j.get(j.CF_LOADED_TESTCASE_ID_KEY);d!=b.id&&(j.set(j.CF_LOADED_TESTCASE_ID_KEY,b.id),j.remove(j.CF_EDITOR_CONTENT_KEY)),g.$broadcast("cf:testCaseLoaded",a.testCase),g.$broadcast("cf:profileLoaded",a.testCase.testContext.profile),g.$broadcast("cf:valueSetLibraryLoaded",a.testCase.testContext.vocabularyLibrary)}a.loadingTC=!1})},a.init=function(){j.remove(j.ACTIVE_SUB_TAB_KEY),a.error=null,a.loading=!0,a.testCases=[];var b=new h;b.then(function(b){angular.forEach(b,function(a){l.buildCFTestCases(a)}),a.testCases=f("orderBy")(b,"position"),a.tree.build_all(a.testCases);var c=null,d=j.get(j.CF_LOADED_TESTCASE_ID_KEY);if(null!=d)for(var e=0;e<a.testCases.length;e++){var g=l.findOneById(d,a.testCases[e]);if(null!=g){c=g;break}}null==c&&(c=a.testCases[0]),a.selectNode(c.id,c.type),a.loading=!1,a.error=null},function(){a.error="Sorry,cannot load the profiles",a.loading=!1})},a.selectNode=function(b,c){i(function(){l.selectNodeByIdAndType(a.tree,b,c)},0)},a.openProfileInfo=function(){e.open({templateUrl:"CFProfileInfoCtrl.html",windowClass:"profile-modal",controller:"CFProfileInfoCtrl"})},a.isSelectable=function(a){return a.testContext&&null!=a.testContext}}]),angular.module("cf").controller("CFProfileInfoCtrl",["$scope","$modalInstance",function(a,b){a.close=function(){b.dismiss("cancel")}}]),angular.module("cf").controller("CFValidatorCtrl",["$scope","$http","CF","$window","$timeout","$modal","NewValidationResult","DQAValidationResult","$rootScope","ServiceDelegator","StorageService",function(a,b,c,d,e,f,g,h,i,j,k){a.validator=null,a.parser=null,a.editorService=null,a.treeService=null,a.cursorService=null,a.cf=c,a.testCase=c.testCase,a.message=c.message,a.selectedMessage={},a.loading=!0,a.error=null,a.vError=null,a.vLoading=!0,a.mError=null,a.mLoading=!0,a.delimeters=[],a.counter=0,a.type="cf",a.loadRate=4e3,a.tokenPromise=null,a.editorInit=!1,a.nodelay=!1,a.resized=!1,a.selectedItem=null,a.activeTab=0,a.tError=null,a.tLoading=!1,a.dqaCodes=null!=k.get(k.DQA_OPTIONS_KEY)?angular.fromJson(k.get(k.DQA_OPTIONS_KEY)):[],a.showDQAOptions=function(){var b=f.open({templateUrl:"DQAConfig.html",controller:"DQAConfigCtrl",windowClass:"dq-modal",animation:!0,keyboard:!1,backdrop:!1});b.result.then(function(b){a.dqaCodes=b},function(){})},a.hasContent=function(){return""!=a.cf.message.content&&null!=a.cf.message.content},a.refreshEditor=function(){e(function(){a.editor.refresh()},1e3)},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/message/upload";c.submit().success(function(c){a.nodelay=!0;var d=angular.fromJson(c);a.cf.message.name=b,a.cf.editor.instance.doc.setValue(d.content),a.mError=null,a.execute()}).error(function(c,d,e){a.cf.message.name=b,a.mError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(){})})}),a.loadMessage=function(){a.cf.testCase.testContext.message&&null!=a.cf.testCase.testContext.message&&(a.nodelay=!0,a.selectedMessage=a.cf.testCase.testContext.message,null!=a.selectedMessage&&null!=a.selectedMessage.content?a.editor.doc.setValue(a.selectedMessage.content):(a.editor.doc.setValue(""),a.cf.message.id=null,a.cf.message.name=""),a.execute())},a.setLoadRate=function(b){a.loadRate=b},a.initCodemirror=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("cfTextArea"),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",readOnly:!1,showCursorWhenSelecting:!0,gutters:["CodeMirror-linenumbers","cm-edi-segment-name"]}),a.editor.setSize("100%",345),a.editor.on("keyup",function(){e(function(){var b=a.editor.doc.getValue();a.error=null,a.tokenPromise&&(e.cancel(a.tokenPromise),a.tokenPromise=void 0),c.message.name=null,""!==b.trim()?a.tokenPromise=e(function(){a.execute()},a.loadRate):a.execute()})}),a.editor.on("dblclick",function(){e(function(){var b=a.cursorService.getCoordinate(a.editor);a.cf.cursor.init(b.line,b.startIndex,b.endIndex,b.index,!0),a.treeService.selectNodeByIndex(a.cf.tree.root,c.cursor,c.message.content)})}),a.cf.editor.instance=a.editor,a.refreshEditor()},a.validateMessage=function(){try{if(a.vLoading=!0,a.vError=null,a.dqaError=null,a.cf.dqaValidationResult=null,null!=a.cf.testCase&&""!==a.cf.message.content){var b=a.cf.testCase.testContext.id,c=a.cf.message.content,d=(a.cf.testCase.label,a.validator.validate(b,c,a.cf.testCase.nav,"Free",a.dqaCodes,"1223"));d.then(function(b){a.vLoading=!1,a.loadValidationResult(b)},function(b){a.vLoading=!1,a.vError=b,a.loadValidationResult(null)})}else a.loadValidationResult(null),a.vLoading=!1,a.vError=null}catch(e){a.vLoading=!1,a.vError=e,a.loadValidationResult(null)}},a.loadValidationResult=function(a){e(function(){i.$broadcast("cf:validationResultLoaded",a)})},a.select=function(b){if(void 0!=b&&null!=b.path&&-1!=b.line){var c=a.treeService.selectNodeByPath(a.cf.tree.root,b.line,b.path),d=null!=c?c.data:null;a.cf.cursor.init(null!=d?d.lineNumber:b.line,null!=d?d.startIndex-1:b.column-1,null!=d?d.endIndex-1:b.column-1,null!=d?d.startIndex-1:b.column-1,!1),a.editorService.select(a.editor,a.cf.cursor)}},a.clearMessage=function(){a.nodelay=!0,a.mError=null,a.editor&&(a.editor.doc.setValue(""),a.execute())},a.saveMessage=function(){a.cf.message.download()},a.parseMessage=function(){try{if(null!=a.cf.testCase&&null!=a.cf.testCase.testContext&&""!=a.cf.message.content){a.tLoading=!0;var b=a.parser.parse(a.cf.testCase.testContext.id,a.cf.message.content);b.then(function(b){a.tLoading=!1,a.cf.tree.root.build_all(b.elements),j.updateEditorMode(a.editor,b.delimeters,a.cf.testCase.testContext.format),a.editorService.setEditor(a.editor),a.treeService.setEditor(a.editor)},function(b){a.tLoading=!1,a.tError=b})}else"function"==typeof a.cf.tree.root.build_all&&a.cf.tree.root.build_all([]),a.tError=null,a.tLoading=!1}catch(c){a.tLoading=!1,a.tError=c}},a.onNodeSelect=function(b){var c=a.treeService.getEndIndex(b,a.cf.message.content);a.cf.cursor.init(b.data.lineNumber,b.data.startIndex-1,c-1,b.data.startIndex-1,!1),a.editorService.select(a.editor,a.cf.cursor)},a.execute=function(){null!=a.cf.testCase&&(a.error=null,a.tError=null,a.mError=null,a.vError=null,a.cf.message.content=a.editor.doc.getValue(),k.set(k.CF_EDITOR_CONTENT_KEY,a.cf.message.content),a.validateMessage(),a.parseMessage())},a.init=function(){a.vLoading=!1,a.tLoading=!1,a.mLoading=!1,a.error=null,a.tError=null,a.mError=null,a.vError=null,a.initCodemirror(),a.$on("cf:refreshEditor",function(){a.refreshEditor()}),i.$on("cf:testCaseLoaded",function(b,c){e(function(){if(a.testCase=c,a.refreshEditor(),null!=a.testCase){var b=null==k.get(k.CF_EDITOR_CONTENT_KEY)?"":k.get(k.CF_EDITOR_CONTENT_KEY);a.nodelay=!0,a.mError=null,a.validator=j.getMessageValidator(a.testCase.testContext.format),a.parser=j.getMessageParser(a.testCase.testContext.format),a.editorService=j.getEditorService(a.testCase.testContext.format),a.treeService=j.getTreeService(a.testCase.testContext.format),a.cursorService=j.getCursorService(a.testCase.testContext.format),a.editor&&(a.editor.doc.setValue(b),a.execute())}})})}}]),angular.module("cf").controller("CFReportCtrl",["$scope","$sce","$http","CF",function(a,b,c,d){a.cf=d}]),angular.module("cf").controller("CFVocabularyCtrl",["$scope","CF",function(a,b){a.cf=b}]),angular.module("cf").controller("CFProfileViewerCtrl",["$scope","CF","$rootScope",function(a,b){a.cf=b}]),angular.module("cb").controller("CBTestingCtrl",["$scope","$window","$rootScope","CB","StorageService",function(a,b,c,d,e){a.init=function(){var a=e.get(e.ACTIVE_SUB_TAB_KEY);(null==a||"/cb_execution"!=a)&&(a="/cb_testcase"),c.setSubActive(a)},a.getTestType=function(){return d.testCase.type},a.disabled=function(){return null==d.testCase||null===d.testCase.id}}]),angular.module("cb").controller("CBExecutionCtrl",["$scope","$window","$rootScope","$timeout","StorageService",function(a,b,c,d){a.loading=!1,a.error=null,a.tabs=new Array,a.testCase=null,a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0},a.getTestType=function(){return null!=a.testCase?a.testCase.type:""},a.init=function(){a.error=null,a.setActiveTab(0),c.$on("cb:testCaseLoaded",function(b,e,f){a.loading=!0,d(function(){c.setSubActive(f&&null!=f?f:"/cb_execution"),a.testCase=e,a.setActiveTab(0),c.$broadcast("cb:profileLoaded",a.testCase.testContext.profile),c.$broadcast("cb:valueSetLibraryLoaded",a.testCase.testContext.vocabularyLibrary),a.loading=!1})})}}]),angular.module("cb").controller("CBTestCaseCtrl",["$scope","$window","$filter","$rootScope","CB","$timeout","CBTestCaseListLoader","$sce","StorageService","TestCaseService",function(a,b,c,d,e,f,g,h,i,j){a.selectedTestCase=e.selectedTestCase,a.testCase=e.testCase,a.testCases=[],a.tree={},a.loading=!0,a.loadingTC=!1,a.error=null;var k=new j;a.init=function(){a.error=null,a.loading=!0;var b=new g;b.then(function(b){a.error=null,angular.forEach(b,function(a){k.buildTree(a)}),a.testCases=b,a.tree.build_all(a.testCases);var c=null,d=i.get(i.CB_SELECTED_TESTCASE_ID_KEY),e=i.get(i.CB_SELECTED_TESTCASE_TYPE_KEY);if(null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var g=k.findOneByIdAndType(d,e,a.testCases[f]);if(null!=g){c=g;break}}null!=c&&a.selectNode(d,e)}if(c=null,d=i.get(i.CB_LOADED_TESTCASE_ID_KEY),e=i.get(i.CB_LOADED_TESTCASE_TYPE_KEY),null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var g=k.findOneByIdAndType(d,e,a.testCases[f]);if(null!=g){c=g;break}}if(null!=c){var h=i.get(i.ACTIVE_SUB_TAB_KEY);a.loadTestCase(c,h)}}a.loading=!1},function(){a.loading=!1,a.error="Sorry,cannot load the test cases. Please refresh your page and try again."})},a.refreshEditor=function(){f(function(){a.editor&&a.editor.refresh()},1e3)},a.isSelectable=function(){return!0},a.selectTestCase=function(b){a.loadingTC=!0,a.selectedTestCase=b,i.set(i.CB_SELECTED_TESTCASE_ID_KEY,b.id),i.set(i.CB_SELECTED_TESTCASE_TYPE_KEY,b.type),f(function(){d.$broadcast("cb:testCaseSelected",a.selectedTestCase),a.loadingTC=!1})},a.selectNode=function(b,c){f(function(){k.selectNodeByIdAndType(a.tree,b,c)},0)},a.selectTestPlan=function(b){(null==a.selectedTestCase||a.selectedTestCase.id!=b.id)&&(a.selectedTestCase=b)},a.loadTestCase=function(b,c){f(function(){if("TestStep"===b.type){e.testCase=b,a.testCase=e.testCase;var g=i.get(i.CB_LOADED_TESTCASE_ID_KEY),h=i.get(i.CB_LOADED_TESTCASE_TYPE_KEY);(g!=a.testCase.id||h!=a.testCase.type)&&(i.set(i.CB_LOADED_TESTCASE_ID_KEY,a.testCase.id),i.set(i.CB_LOADED_TESTCASE_TYPE_KEY,a.testCase.type),i.remove(i.CB_EDITOR_CONTENT_KEY)),f(function(){d.$broadcast("cb:testCaseLoaded",a.testCase,c)})}})},a.expand=function(){}}]),angular.module("cb").controller("CBValidatorCtrl",["$scope","$http","CB","$window","$timeout","$modal","NewValidationResult","$rootScope","ServiceDelegator","StorageService",function(a,b,c,d,e,f,g,h,i,j){a.cb=c,a.testCase=c.testCase,a.message=c.message,a.selectedMessage={},a.loading=!0,a.error=null,a.vError=null,a.vLoading=!0,a.mError=null,a.mLoading=!0,a.validator=null,a.editorService=null,a.treeService=null,a.cursorService=null,a.parser=null,a.counter=0,a.type="cb",a.loadRate=4e3,a.tokenPromise=null,a.editorInit=!1,a.nodelay=!1,a.resized=!1,a.selectedItem=null,a.activeTab=0,a.messageObject=[],a.tError=null,a.tLoading=!1,a.dqaCodes=null!=j.get(j.DQA_OPTIONS_KEY)?angular.fromJson(j.get(j.DQA_OPTIONS_KEY)):[],a.showDQAOptions=function(){var b=f.open({templateUrl:"DQAConfig.html",controller:"DQAConfigCtrl",windowClass:"dq-modal",animation:!0,keyboard:!1,backdrop:!1});b.result.then(function(b){a.dqaCodes=b},function(){})},a.hasContent=function(){return""!=a.cb.message.content&&null!=a.cb.message.content},a.refreshEditor=function(){e(function(){a.editor.refresh()},1e3)},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/message/upload";c.submit().success(function(c){a.nodelay=!0;var d=angular.fromJson(c);a.cb.message.name=b,a.cb.editor.instance.doc.setValue(d.content),a.mError=null,a.execute()}).error(function(c,d,e){a.cb.message.name=b,a.mError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(){})})}),a.loadMessage=function(){var b=a.cb.testCase,c=(b.testContext,a.cb.testCase.testContext.message),d=c&&null!=c?c.content:null;null!=d&&""!=d&&(a.editor.doc.setValue(d),a.cb.message.id=null,a.cb.message.name="",a.nodelay=!0,a.execute())},a.setLoadRate=function(b){a.loadRate=b},a.initCodemirror=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("cb-textarea"),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setSize("100%",345),a.editor.on("keyup",function(){e(function(){var b=a.editor.doc.getValue();a.error=null,a.tokenPromise&&(e.cancel(a.tokenPromise),a.tokenPromise=void 0),c.message.name=null,""!==b.trim()?a.tokenPromise=e(function(){a.execute()},a.loadRate):a.execute()})}),a.editor.on("dblclick",function(){e(function(){var b=a.cursorService.getCoordinate(a.editor);a.cb.cursor.init(b.line,b.startIndex,b.endIndex,b.index,!0),a.treeService.selectNodeByIndex(a.cb.tree.root,c.cursor,c.message.content)})}),a.cb.editor.instance=a.editor,a.refreshEditor()},a.validateMessage=function(){try{if(a.vLoading=!0,a.vError=null,null!=a.cb.testCase&&""!==a.cb.message.content){var b=a.validator.validate(a.cb.testCase.testContext.id,a.cb.message.content,a.cb.testCase.nav,"Based",a.dqaCodes,"1223");b.then(function(b){a.vLoading=!1,a.loadValidationResult(b)},function(b){a.vLoading=!1,a.vError=b,a.loadValidationResult(null)})}else a.loadValidationResult(null),a.vLoading=!1,a.vError=null}catch(c){a.vLoading=!1,a.vError=c,a.loadValidationResult(null)}},a.loadValidationResult=function(a){e(function(){h.$broadcast("cb:validationResultLoaded",a)})},a.select=function(b){if(void 0!=b&&null!=b.path&&-1!=b.line){var c=a.treeService.selectNodeByPath(a.cb.tree.root,b.line,b.path),d=null!=c?c.data:null;a.cb.cursor.init(null!=d?d.lineNumber:b.line,null!=d?d.startIndex-1:b.column-1,null!=d?d.endIndex-1:b.column-1,null!=d?d.startIndex-1:b.column-1,!1),a.editorService.select(a.editor,a.cb.cursor)}},a.clearMessage=function(){a.nodelay=!0,a.mError=null,a.editor&&(a.editor.doc.setValue(""),a.execute())},a.saveMessage=function(){a.cb.message.download()},a.parseMessage=function(){try{if(null!=a.cb.testCase&&null!=a.cb.testCase.testContext&&""!=a.cb.message.content){a.tLoading=!0;var b=a.parser.parse(a.cb.testCase.testContext.id,a.cb.message.content);b.then(function(b){a.tLoading=!1,a.cb.tree.root.build_all(b.elements),i.updateEditorMode(a.editor,b.delimeters,a.testCase.testContext.format),a.editorService.setEditor(a.editor),a.treeService.setEditor(a.editor)},function(b){a.tLoading=!1,a.tError=b})}else"function"==typeof a.cb.tree.root.build_all&&a.cb.tree.root.build_all([]),a.tError=null,a.tLoading=!1}catch(c){a.tLoading=!1,a.tError=c}},a.onNodeSelect=function(b){var c=a.treeService.getEndIndex(b,a.cb.message.content);a.cb.cursor.init(b.data.lineNumber,b.data.startIndex-1,c-1,b.data.startIndex-1,!1),a.editorService.select(a.editor,a.cb.cursor)},a.execute=function(){null!=a.cb.testCase&&(a.error=null,a.tError=null,a.mError=null,a.vError=null,a.cb.message.content=a.editor.doc.getValue(),j.set(j.CB_EDITOR_CONTENT_KEY,a.cb.message.content),a.validateMessage(),a.parseMessage())},a.init=function(){a.vLoading=!1,a.tLoading=!1,a.mLoading=!1,a.error=null,a.tError=null,a.mError=null,a.vError=null,a.initCodemirror(),a.refreshEditor(),a.$on("cb:refreshEditor",function(){a.refreshEditor()}),h.$on("cb:testCaseLoaded",function(b,c){if(a.refreshEditor(),a.testCase=c,null!=a.testCase){var d=null==j.get(j.CB_EDITOR_CONTENT_KEY)?"":j.get(j.CB_EDITOR_CONTENT_KEY);a.nodelay=!0,a.mError=null,a.validator=i.getMessageValidator(a.testCase.testContext.format),a.parser=i.getMessageParser(a.testCase.testContext.format),a.editorService=i.getEditorService(a.testCase.testContext.format),a.treeService=i.getTreeService(a.testCase.testContext.format),a.cursorService=i.getCursorService(a.testCase.testContext.format),a.editor&&(a.editor.doc.setValue(d),a.execute())}})}}]),angular.module("cb").controller("CBProfileViewerCtrl",["$scope","CB",function(a,b){a.cb=b}]),angular.module("cb").controller("CBReportCtrl",["$scope","$sce","$http","CB",function(a,b,c,d){a.cb=d}]),angular.module("cb").controller("CBVocabularyCtrl",["$scope","CB",function(a,b){a.cb=b}]),angular.module("envelope").controller("EnvelopeTestingCtrl",["$scope","$window","$rootScope","Envelope","StorageService",function(a,b,c,d,e){a.loading=!1,a.error=null,a.tabs=new Array,a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0},a.init=function(){var a=e.get(e.ACTIVE_SUB_TAB_KEY);(null==a||"/envelope_execution"!=a)&&(a="/envelope_testcase"),c.setSubActive(a)},c.$on("env:testCaseLoaded",function(a,b,e){null!=d.testCase&&null!=d.testCase.id&&c.setSubActive(e&&null!=e?e:"/envelope_execution")}),a.hasContent=function(){return""!=d.getContent()&&null!=d.getContent()},a.disabled=function(){return null==d.testCase||null===d.testCase.id}}]),angular.module("envelope").controller("EnvelopeExecutionCtrl",["$scope","$window","$rootScope","Envelope",function(a,b,c,d){a.loading=!0,a.error=null,a.tabs=new Array,a.testCase=d.testCase,a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0},a.getTestType=function(){return null!=a.testCase?a.testCase.type:""},a.init=function(){a.error=null,a.loading=!1,c.$on("env:testCaseLoaded",function(){a.setActiveTab(0),a.testCase=d.testCase})}}]),angular.module("envelope").controller("EnvelopeTestCaseCtrl",["$scope","$window","$rootScope","Envelope","EnvelopeTestCaseListLoader","$timeout","StorageService","TestCaseService",function(a,b,c,d,e,f,g,h){a.selectedTestCase=d.selectedTestCase,a.testCase=d.testCase,a.testCases=[],a.loading=!0,a.error=null,a.tree={};var i=new h;a.init=function(){a.error=null,a.testCases=[],a.loading=!0;var b=new e;b.then(function(b){a.error=null,a.testCases=b,a.tree.build_all(a.testCases);var c=null,d=g.get(g.SOAP_ENV_SELECTED_TESTCASE_ID_KEY),e=g.get(g.SOAP_ENV_SELECTED_TESTCASE_TYPE_KEY);if(null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var h=i.findOneByIdAndType(d,e,a.testCases[f]);if(null!=h){c=h;break}}null!=c&&(a.selectTestCase(c),a.selectNode(d,e))}if(c=null,d=g.get(g.SOAP_ENV_LOADED_TESTCASE_ID_KEY),e=g.get(g.SOAP_ENV_LOADED_TESTCASE_TYPE_KEY),null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var h=i.findOneByIdAndType(d,e,a.testCases[f]);if(null!=h){c=h;break}}if(null!=c){var j=g.get(g.ACTIVE_SUB_TAB_KEY);a.loadTestCase(c,j)}}a.loading=!1},function(){a.loading=!1,a.error="Sorry,Cannot fetch the test cases. Please refresh the page."})},a.refreshEditor=function(){f(function(){a.$broadcast("envelope:editor:init")})},a.selectTestCase=function(b){f(function(){a.selectedTestCase=b,g.set(g.SOAP_ENV_SELECTED_TESTCASE_ID_KEY,b.id),g.set(g.SOAP_ENV_SELECTED_TESTCASE_TYPE_KEY,b.type),f(function(){c.$broadcast("env:testCaseSelected")})})},a.selectNode=function(b,c){f(function(){i.selectNodeByIdAndType(a.tree,b,c)})},a.loadTestCase=function(b,e){if("TestCase"===b.type){d.testCase=b,a.testCase=d.testCase;var h=g.get(g.SOAP_ENV_LOADED_TESTCASE_ID_KEY),i=g.get(g.SOAP_ENV_LOADED_TESTCASE_TYPE_KEY);(h!=a.testCase.id||i!=a.testCase.type)&&(g.set(g.SOAP_ENV_LOADED_TESTCASE_ID_KEY,a.testCase.id),g.set(g.SOAP_ENV_LOADED_TESTCASE_TYPE_KEY,a.testCase.type),g.remove(g.SOAP_ENV_EDITOR_CONTENT_KEY)),f(function(){c.$broadcast("env:testCaseLoaded",a.testCase,e)})}},a.isSelectable=function(){return!0}}]),angular.module("envelope").controller("EnvelopeValidatorCtrl",["$scope","$http","$window","XmlFormatter","Envelope","XmlEditorUtils","$rootScope","XmlParser","XmlTreeUtils","EnvelopeValidator","$timeout","StorageService",function(a,b,c,d,e,f,g,h,i,j,k,l){a.testCase=e.testCase,a.selectedTestCase=e.selectedTestCase,a.vLoading=!0,a.vError=null,a.selectedMessage={id:-1,content:""},a.eLoading=!1,a.validating=!1,a.editorInit=!1,a.eError=null,a.rLoading=!1,a.rError=null,a.resized=!1,a.validationSettings=e.validationSettings,a.validationResult=e.validationResult,a.errors=a.validationResult.errors,a.errorsCollection=[].concat(a.errors.data),a.affirmatives=a.validationResult.affirmatives,a.affirmativesCollection=[].concat(a.affirmatives.data),a.alerts=a.validationResult.alerts,a.alertsCollection=[].concat(a.alerts.data),a.ignores=a.validationResult.ignores,a.ignoresCollection=[].concat(a.ignores.data),a.warnings=a.validationResult.warnings,a.warningsCollection=[].concat(a.warnings.data),a.tError=null,a.envelopeTree={},a.tLoading=!1,a.refreshEditor=function(){void 0!=a.editor&&k(function(){a.editor.refresh()},1e3)},a.loadExampleMessage=function(){var b=e.testCase.testContext.exampleMessage.content,c=new d(b);c.then(function(b){a.message(b)},function(c){a.error=c,a.message(b)})},a.message=function(b){e.message.content=b,e.editor.instance.doc.setValue(b),l.set(l.SOAP_ENV_EDITOR_CONTENT_KEY,b),a.refreshEditor(),a.validateMessage(),a.parse()},a.validate=function(){a.error=null;var b=e.editor.instance.doc.getValue();if(""!=b){a.validating=!0;var c=new d(b);c.then(function(b){a.validating=!1,a.message(b)},function(b){a.validating=!1,a.error=b})}else a.message("")},a.init=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("envelopeTextArea"),{lineNumbers:!0,fixedGutter:!0,mode:"xml",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.on("dblclick",function(b){a.$apply(function(){e.cursor.setLine(b.doc.getCursor(!0).line+1)})}),a.editor.setSize("100%",300),e.editor.init(a.editor),a.tLoading=!1,a.$watch(function(){return e.cursor.updateIndicator},function(){f.select(e.cursor,a.editor)},!0),a.$watch(function(){return e.cursor.toString()},function(){i.selectNode(a.envelopeTree,e.cursor)},!0),g.$on("env:testCaseLoaded",function(){a.testCase=e.testCase;var b=null==l.get(l.SOAP_ENV_EDITOR_CONTENT_KEY)?"":l.get(l.SOAP_ENV_EDITOR_CONTENT_KEY);a.message(b)}),a.setValidationResult({}),a.refreshEditor()},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/soap/upload";c.submit().success(function(c){angular.fromJson(c);a.message(c.content),a.uploadError=null,a.fileName=b}).error(function(c,d,e){a.fileName=b,a.uploadError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(){})})}),a.getMessageName=function(){return e.message.name},a.clearMessage=function(){a.error=null,a.message("")},a.saveMessage=function(){e.message.download()},a.resize=function(){},a.validateMessage=function(){if(a.rLoading=!0,a.rError=null,null!=e.testCase.id&&null!=e.editor.instance&&""!=e.editor.instance.doc.getValue()){var b=(new j).validate(e.message.content,e.testCase.id);b.then(function(b){a.rLoading=!1,a.setValidationResult(b)},function(b){a.rLoading=!1,a.rError=b,a.setValidationResult({})})}else a.setValidationResult({}),a.rLoading=!1,a.rError=null},a.setValidationResult=function(b){e.validationResult.init(b),a.validationResult=e.validationResult,a.errors=a.validationResult.errors,a.affirmatives=a.validationResult.affirmatives,a.alerts=a.validationResult.alerts,a.ignores=a.validationResult.ignores,a.warnings=a.validationResult.warnings},a.select=function(a){-1!=a.line&&e.cursor.setLine(a.line)},a.parse=function(){if(a.tLoading=!0,a.tError=null,null!==e.testCase.id&&""!=e.getContent()){var b=new h(e.getContent());b.then(function(b){a.tLoading=!1,a.envelopeTree.build_all(b),i.expandTree(a.envelopeTree)},function(b){a.tLoading=!1,a.tError=b,a.envelopeTree.build_all([])})}else a.tLoading=!1,a.envelopeTree.build_all([])},a.onEnvelopeNodeSelect=function(a){i.setCoordinate(a,e.cursor)}}]),angular.module("envelope").controller("EnvelopeReportCtrl",["$scope","$sce","$http","Envelope","SoapValidationReportGenerator","SoapValidationReportDownloader","$rootScope",function(a,b,c,d,e,f,g){a.envelopeHtmlReport=null,a.error=null,a.loading=!1,a.testCase=d.testCase,a.init=function(){a.$watch(function(){return d.validationResult.xml},function(b){if(null!=b&&""!=b){a.loading=!0;var c=new e(b,"html");c.then(function(b){a.envelopeHtmlReport=b.htmlReport,a.loading=!1,a.error=null},function(b){a.error=b,a.loading=!1,a.envelopeHtmlReport=null})}else a.loading=!1,a.envelopeHtmlReport=null,a.error=null},!0),g.$on("env:testCaseLoaded",function(){a.testCase=d.testCase})},a.downloadAs=function(a){f.downloadAs(d.validationResult.xml,a)}}]),angular.module("isolated").controller("IsolatedSystemTestingCtrl",["$scope","$window","$rootScope","IsolatedSystem","StorageService",function(a,b,c,d,e){a.getTestType=function(){return d.testCase.type},a.init=function(){a.error=null,a.loading=!1;var b=e.get(e.ACTIVE_SUB_TAB_KEY);(null==b||"/isolated_execution"!=b)&&(b="/isolated_testcase"),c.setSubActive(b),c.$on("isolated:testCaseLoaded",function(a,b,d){null!=b&&null!=b.id&&c.setSubActive(d&&null!=d?d:"/isolated_execution")})},a.disabled=function(){return null==d.testCase||null===d.testCase.id}}]),angular.module("isolated").controller("IsolatedSystemTestCaseCtrl",["$scope","$filter","$window","$rootScope","IsolatedSystem","$timeout","IsolatedSystemTestCaseListLoader","StorageService","TestCaseService",function(a,b,c,d,e,f,g,h,i){a.selectedTestCase=e.selectedTestCase,a.testCase=e.testCase,a.testCases=[],a.tree={},a.loading=!0,a.error=null;var j=new i;a.init=function(){a.error=null,a.loading=!0;var b=new g;b.then(function(b){a.error=null,angular.forEach(b,function(a){j.buildTree(a)}),a.testCases=b,a.tree.build_all(a.testCases);var c=null,d=h.get(h.ISOLATED_SELECTED_TESTCASE_ID_KEY),e=h.get(h.ISOLATED_SELECTED_TESTCASE_TYPE_KEY);if(null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var g=j.findOneByIdAndType(d,e,a.testCases[f]);if(null!=g){c=g;break}}null!=c&&a.selectNode(d,e)}if(c=null,d=h.get(h.ISOLATED_LOADED_TESTCASE_ID_KEY),e=h.get(h.ISOLATED_LOADED_TESTCASE_TYPE_KEY),null!=d&&null!=e){for(var d=h.get(h.ISOLATED_SELECTED_TESTCASE_ID_KEY),e=h.get(h.ISOLATED_SELECTED_TESTCASE_TYPE_KEY),f=0;f<a.testCases.length;f++){var g=j.findOneByIdAndType(d,e,a.testCases[f]);if(null!=g){c=g;break}}if(null!=c){var i=h.get(h.ACTIVE_SUB_TAB_KEY);a.loadTestCase(c,i)}}a.loading=!1},function(){a.loading=!1,a.error="Sorry,cannot load the test cases. Please refresh your page and try again."})},a.refreshEditor=function(){f(function(){a.editor&&a.editor.refresh()},1e3)},a.selectNode=function(b,c){f(function(){j.selectNodeByIdAndType(a.tree,b,c)},0)},a.selectTestCase=function(b){f(function(){a.selectedTestCase=b,h.set(h.ISOLATED_SELECTED_TESTCASE_ID_KEY,b.id),h.set(h.ISOLATED_SELECTED_TESTCASE_TYPE_KEY,b.type),f(function(){d.$broadcast("isolated:testCaseSelected",a.selectedTestCase)})
},0)},a.selectTestPlan=function(b){(null==a.selectedTestCase||a.selectedTestCase.id!=b.id)&&(a.selectedTestCase=b)},a.loadTestCase=function(b,c){"TestCase"===b.type&&(a.testCase=angular.copy(b),(h.get(h.ISOLATED_LOADED_TESTCASE_ID_KEY)!=a.testCase.id||h.get(h.ISOLATED_LOADED_TESTCASE_TYPE_KEY)!=a.testCase.type)&&(h.set(h.ISOLATED_LOADED_TESTCASE_ID_KEY,a.testCase.id),h.set(h.ISOLATED_LOADED_TESTCASE_TYPE_KEY,a.testCase.type),h.remove(h.ISOLATED_EDITOR_CONTENT_KEY),h.remove(h.ISOLATED_LOADED_TESTSTEP_TYPE_KEY),h.remove(h.ISOLATED_LOADED_TESTSTEP_ID_KEY)),f(function(){d.$broadcast("isolated:testCaseLoaded",a.testCase,c)}))},a.downloadTestStory=function(){if(null!=a.selectedTestCase){var b=document.createElement("form");b.action="api/teststory/download",b.method="POST",b.target="_target";var c=document.createElement("input");c.name="path",c.value=a.selectedTestCase.testStory.pdfPath,b.appendChild(c);var d=document.createElement("input");d.name="title",d.value=a.selectedTestCase.name,b.appendChild(d),b.style.display="none",document.body.appendChild(b),b.submit()}},a.isSelectable=function(){return!0}}]),angular.module("isolated").controller("IsolatedSystemExecutionCtrl",["$scope","$window","$rootScope","IsolatedSystem","$modal","IsolatedSystemInitiator","IsolatedSystemClock","XmlEscaper","Endpoint","IsolatedExecutionService","$timeout","StorageService",function(a,b,c,d,e,f,g,h,i,j,k,l){a.loading=!0,a.error=null,a.tabs=new Array,a.testCase=null,a.testStep=null,a.logger=d.logger,a.connecting=!1,a.error=null,a.user=d.user,a.endpoint=null,a.hidePwd=!0,a.sent=null,a.received=null,a.configCollapsed=!0,a.counterMax=30,a.counter=0,a.listenerReady=!1,a.testStepListCollapsed=!1,a.warning=null;var m=["Configuring connection. Please wait...","Connection configured.","Waiting for incoming message....Elapsed time(second):","<-------------------------------------- Inbound Message ","Inbound SOAP Envelope is Invalid","Outbound SOAP Envelope is Invalid","Transaction completed","We did not receive any incoming message after 30s. <p>Possible cause (1): You are using wrong credentials. Please check the credentials in your outbound SOAP Envelope against those created for your system.</p>  <p>Possible cause (2):The SOAP endpoint address may be incorrect.   Verify that you are using the correct SOAP endpoint address that is displayed by the tool.</p><p>Possible cause (3):The HTTP header field Content-Type  may not be set correctly for use with SOAP 1.2.   SOAP 1.2 requires application/soap+xml, and SOAP 1.2 requires text/xml.  The NIST Tool follows SOAP 1.2, which is required by section 2 of the 'CDC Transport Layer Protocol Recommendation V1.1' (http://www.cdc.gov/vaccines/programs/iis/technical-guidance/SOAP/downloads/transport-specification.pdf)</p>","We did not receive any incoming message after 30s","We were unable to send the response after 30s","Failed to configure incoming connection. ","Transaction aborted","Outbound Message  -------------------------------------->","Transaction stopped","Stopping transaction. Please wait...."],n=["Outbound Message ========================>","Outbound message sent successfully.","Inbound message received <========================","Transaction completed","Incorrect SOAP Envelope received","Transaction aborted","Transaction stopped"],o=["Incorrect SOAP Envelope Received. Please check the log for more details","No Outbound message found","Invalid SOAP Envelope Received. Please see console for more details.","Invalid SOAP Envelope Sent. Please see console for more details."],p=function(a){var b=new X2JS,c=b.xml_str2json(a),d=h.decodeXml(c.Envelope.Body.submitSingleMessage.hl7Message.toString());return d},q=function(a){var b=new X2JS,c=b.xml_str2json(a),d=h.decodeXml(c.Envelope.Body.submitSingleMessageResponse.return.toString());return d};a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.tabs[4]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0},a.getTestType=function(){return null!=a.testCase?a.testCase.type:""},a.resetTestCase=function(){k(function(){l.remove(l.ISOLATED_LOADED_TESTSTEP_TYPE_KEY),l.remove(l.ISOLATED_LOADED_TESTSTEP_ID_KEY),c.$broadcast("isolated:testCaseLoaded",a.testCase)})},a.selectTestStep=function(b){d.testStep=b,a.testStep=b,l.set(l.ISOLATED_LOADED_TESTSTEP_TYPE_KEY,a.testStep.type),l.set(l.ISOLATED_LOADED_TESTSTEP_ID_KEY,a.testStep.id),null!=b&&(void 0===b.executionMessage&&"TA_INITIATOR"===b.testingType&&j.setExecutionMessage(b,b.testContext.message.content),!a.isManualStep(b)&&b.testContext&&null!=b.testContext&&(k(function(){c.$broadcast("isolated:testStepLoaded",b)}),k(function(){c.$broadcast("isolated:profileLoaded",b.testContext.profile)}),k(function(){c.$broadcast("isolated:valueSetLibraryLoaded",b.testContext.vocabularyLibrary)})))},a.clearTestStep=function(){d.testStep=null,a.testStep=null,k(function(){c.$broadcast("isolated:removeTestStep")})},a.getExecutionStatus=function(a){return j.getExecutionStatus(a)},a.getValidationStatus=function(a){return j.getValidationStatus(a)},a.isManualStep=function(a){return"TA_MANUAL"===a.testingType||"SUT_MANUAL"===a.testingType},a.isSutInitiator=function(a){return"SUT_INITIATOR"==a.testingType},a.isStepCompleted=function(b){return"COMPLETE"==a.getExecutionStatus(b)},a.completeStep=function(a){j.setExecutionStatus(a,"COMPLETE")},a.completeManualStep=function(b){a.completeStep(b)},a.progressStep=function(a){j.setExecutionStatus(a,"IN_PROGRESS")},a.executeNextTestStep=function(b){a.testStepListCollapsed=!1,a.isManualStep(b)&&a.completeStep(b),a.isLastStep(b)?(a.testCase.executionStatus="COMPLETE",a.clearTestStep()):a.executeTestStep(a.findNextStep(b.position))},a.executeTestStep=function(b){a.warning=null,a.logger.clear(),null!=b&&(a.isManualStep(b)||(j.deleteValidationReport(b),a.isSutInitiator(b)&&j.setExecutionMessage(b,null),k(function(){c.$broadcast("isolated:clearEditor")})),a.selectTestStep(b))},a.isTestCaseCompleted=function(){return a.testCase&&"COMPLETE"===a.testCase.executionStatus},a.isTestStepCompleted=function(b){return null!=b&&(!a.isManualStep(b)&&"COMPLETE"==a.getExecutionStatus(b)||a.isManualStep(b))},a.shouldNextStep=function(b){return null!=a.testStep&&a.testStep===b&&!a.isTestCaseCompleted()&&!a.isLastStep(b)&&a.isTestStepCompleted(b)},a.isLastStep=function(b){return null!=b&&null!=a.testCase&&a.testCase.children.length===b.position},a.isTestCaseSuccessful=function(){if(null!=a.testCase)for(var b=0;b<a.testCase.children.length;b++)if(a.getValidationStatus(a.testCase.children[b])>0)return!1;return!0},a.testStepSucceed=function(b){return a.getValidationStatus(b)<=0},a.findNextStep=function(b){for(var c=0;c<a.testCase.children.length;c++)if(a.testCase.children[c].position===b+1)return a.testCase.children[c];return null},a.clearExecution=function(){if(null!=a.testCase){for(var b=0;b<a.testCase.children.length;b++){var c=a.testCase.children[b];j.deleteExecutionStatus(c),j.deleteValidationReport(c),j.deleteExecutionMessage(c),j.deleteMessageTree(c)}delete a.testCase.executionStatus}},a.init=function(){a.error=null,a.loading=!1,a.setActiveTab(0),a.user.init().then(function(){a.endpoint=a.user.endpoint},function(b){a.error=b}),c.$on("isolated:testCaseLoaded",function(b,c){if(null!=c){a.clearExecution(),d.testCase=c,a.testCase=c,a.testStep=null,a.logger.clear(),a.loading=!0,a.error=null,a.connecting=!1,a.user.transaction.running&&(g.stop(),a.user.transaction.closeConnection().then(function(){},function(){}));var e=a.testCase.children[0];a.executeTestStep(e)}})},a.setNextStepMessage=function(b){var c=a.findNextStep(a.testStep.position);null==c||a.isManualStep(c)||(a.completeStep(c),j.setExecutionMessage(c,b))},a.log=function(b){a.logger.log(b)},a.isValidConfig=function(){return null!=a.user.receiverEndpoint&&""!=a.user.receiverEndpoint},a.outboundMessage=function(){return null!=a.testStep?a.testStep.testContext.message.content:null},a.isValidConfig=function(){return null!=a.user&&null!=a.user.receiverEndpoint&&""!=a.user.receiverEndpoint},a.hasRequestContent=function(){return null!=a.outboundMessage()&&""!=a.outboundMessage()},a.send=function(){if(a.configCollapsed=!1,a.connecting=!0,a.progressStep(a.testStep),a.error=null,""!=a.user.receiverEndpoint&&a.hasRequestContent()){a.logger.init(),a.received="",a.logger.log(n[0]);var b=(new f).send(a.user,a.testStep.id,a.outboundMessage());b.then(function(b){var c=b.incoming,d=b.outgoing;a.logger.log(n[1]),a.logger.log(d),a.logger.log(n[2]),a.logger.log(c);try{a.completeStep(a.testStep);var e=q(c);a.logger.log(n[3]),a.setNextStepMessage(e)}catch(f){a.error=o[0],a.logger.log(n[4]),a.logger.log(n[3])}a.connecting=!1},function(b){a.connecting=!1,a.error=b.data,a.logger.log("Error: "+b.data),a.received="",a.completeStep(a.testStep),a.logger.log(n[5])})}else a.error=o[1],a.connecting=!1},a.stopListening=function(){a.connecting=!1,a.counter=a.counterMax,g.stop(),a.log(m[14]),a.user.transaction.closeConnection().then(function(){a.log(m[13])},function(){})},a.startListening=function(){var b=a.findNextStep(a.testStep.position);if(null!=b){var d=b.testContext.message.id;a.configCollapsed=!1,a.logger.clear(),a.counter=0,a.connecting=!0,a.error=null,a.warning=null;var e="",f="";a.log(m[0]),a.user.transaction.openConnection(d).then(function(){a.log(m[1]);var b=function(){++a.counter,a.log(m[2]+a.counter+"s"),a.user.transaction.messages().then(function(){var b=a.user.transaction.incoming,d=a.user.transaction.outgoing;if(a.counter<a.counterMax){if(null!=b&&""!=b&&""==e){a.log(m[3]),a.log(b),e=b;try{var g=p(b);j.setExecutionMessage(a.testStep,g),k(function(){c.$broadcast("isolated:setEditorContent",g)})}catch(h){a.error=o[2],a.logger.log(m[4])}}if(null!=d&&""!=d&&""==f){a.log(m[12]),a.log(d),f=d;try{var i=q(d);a.setNextStepMessage(i)}catch(h){a.error=o[3],a.logger.log(m[5]),a.logger.log(m[6])}}""!=b&&""!=d&&null!=b&&null!=d&&a.stopListening()}else null==b||""==b?(a.warning=m[7],a.log(m[8])):(null==d||""==d)&&a.log(m[9]),a.stopListening()},function(b){a.error=b,a.log("Error: "+b),a.received="",a.sent="",a.stopListening()})};g.start(b)},function(b){a.log(m[10]+"Error: "+b),a.log(m[11]),a.connecting=!1,a.error=b})}},a.downloadJurorDoc=function(a,b){var c=$("#"+a).html();if(c&&""!=c){var d=document.createElement("form");d.action="api/testartifact/generateJurorDoc/pdf",d.method="POST",d.target="_target";var e=document.createElement("textarea");e.name="html",e.value=c,d.appendChild(e);var f=document.createElement("input");f.name="type",f.value="JurorDocument",d.style.display="none",d.appendChild(f);var g=document.createElement("input");g.name="type",g.value=b,d.style.display="none",d.appendChild(g),document.body.appendChild(d),d.submit()}},a.downloadTestArtifact=function(b){if(null!=a.testCase){var c=document.createElement("form");c.action="api/testartifact/download",c.method="POST",c.target="_target";var d=document.createElement("input");d.name="path",d.value=b,c.appendChild(d),c.style.display="none",document.body.appendChild(c),c.submit()}}}]),angular.module("isolated").controller("IsolatedSystemValidatorCtrl",["$scope","$http","IsolatedSystem","$window","$timeout","$modal","NewValidationResult","$rootScope","ServiceDelegator","IsolatedExecutionService",function(a,b,c,d,e,f,g,h,i,j){a.isolated=c,a.testStep=c.testStep,a.message=c.message,a.selectedMessage={},a.loading=!0,a.error=null,a.vError=null,a.vLoading=!0,a.mError=null,a.mLoading=!0,a.counter=0,a.type="isolated",a.loadRate=4e3,a.tokenPromise=null,a.editorInit=!1,a.nodelay=!1,a.resized=!1,a.selectedItem=null,a.activeTab=0,a.tError=null,a.tLoading=!1,a.hasContent=function(){return""!=a.isolated.message.content&&null!=a.isolated.message.content},a.refreshEditor=function(){e(function(){a.editor.refresh()},1e3)},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/message/upload";c.submit().success(function(c){a.nodelay=!0;var d=angular.fromJson(c);a.isolated.message.name=b,a.isolated.editor.instance.doc.setValue(d.content),a.mError=null,a.execute()}).error(function(c,d,e){a.isolated.message.name=b,a.mError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(){})})}),a.loadMessage=function(){if(null!=a.testStep){var b=a.testStep.testContext;if(b){var c=j.getExecutionMessage(a.testStep);c=c&&null!=c?c:"",a.nodelay=!0,a.isolated.editor.instance.doc.setValue(c),a.execute()}}},a.loadExampleMessage=function(){if(null!=a.testStep){var b=a.testStep.testContext;if(b){var c=b.message&&null!=b.message?b.message.content:"";j.setExecutionMessage(a.testStep,c),a.nodelay=!0,a.selectedMessage={content:c},a.isolated.editor.instance.doc.setValue(c),a.execute()}}},a.setLoadRate=function(b){a.loadRate=b},a.initCodemirror=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("isolated-textarea"),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setSize("100%",345),a.editor.on("keyup",function(){e(function(){var b=a.editor.doc.getValue();a.error=null,a.tokenPromise&&(e.cancel(a.tokenPromise),a.tokenPromise=void 0),""!==b.trim()?a.tokenPromise=e(function(){a.execute()},a.loadRate):a.execute()})}),a.editor.on("dblclick",function(){e(function(){var b=a.cursorService.getCoordinate(a.editor);a.isolated.cursor.init(b.line,b.startIndex,b.endIndex,b.index,!0),a.treeService.selectNodeByIndex(a.isolated.tree.root,c.cursor,c.message.content)})}),a.isolated.editor.instance=a.editor,a.refreshEditor()},a.validateMessage=function(){try{if(null!=a.testStep)if(void 0!=j.getValidationResult(a.testStep))a.loadValidationResult(j.getValidationResult(a.testStep)),a.vLoading=!1,a.vError=null;else if(""!==a.isolated.message.content&&null!=a.testStep.testContext)try{a.vLoading=!0,a.vError=null;var b=a.validator.validate(a.testStep.testContext.id,a.isolated.message.content,a.testStep.nav,"Based",[],"1223");b.then(function(b){a.vLoading=!1,a.loadValidationResult(b)},function(b){a.vLoading=!1,a.vError=b,a.loadValidationResult(null)})}catch(c){a.vLoading=!1,a.vError=c,a.loadValidationResult(null)}else a.loadValidationResult(null),a.vLoading=!1,a.vError=null}catch(d){a.vLoading=!1,a.vError=null}},a.loadValidationResult=function(b){null!=a.testStep&&(null!=b&&j.setExecutionStatus(a.testStep,"COMPLETE"),e(function(){h.$broadcast("isolated:validationResultLoaded",b)}))},a.loadMessageObject=function(b){if(null!=a.testStep){a.buildMessageTree(b);var c=b&&null!=b&&b.elements?b:void 0;j.setMessageTree(a.testStep,c)}},a.buildMessageTree=function(b){if(null!=a.testStep){var c=b&&null!=b&&b.elements?b.elements:[];"function"==typeof a.isolated.tree.root.build_all&&a.cb.tree.root.build_all(c);var d=b&&null!=b&&b.delimeters?b.delimeters:[];i.updateEditorMode(a.editor,d,a.testStep.testContext.format),a.editorService.setEditor(a.editor),a.treeService.setEditor(a.editor)}},a.select=function(b){if(void 0!=b&&null!=b.path&&-1!=b.line){var c=a.treeService.selectNodeByPath(a.isolated.tree.root,b.line,b.path),d=null!=c?c.data:null;a.isolated.cursor.init(null!=d?d.lineNumber:b.line,null!=d?d.startIndex-1:b.column-1,null!=d?d.endIndex-1:b.column-1,null!=d?d.startIndex-1:b.column-1,!1),a.editorService.select(a.editor,a.isolated.cursor)}},a.clearMessage=function(){a.nodelay=!0,a.mError=null,a.editor&&(a.editor.doc.setValue(""),a.execute())},a.saveMessage=function(){a.isolated.message.download()},a.parseMessage=function(){try{if(null!=a.testStep)if(void 0!=j.getMessageTree(a.testStep))a.buildMessageTree(j.getMessageTree(a.testStep)),a.tLoading=!1;else if(""!=a.isolated.message.content&&null!=a.testStep.testContext){a.tLoading=!0;var b=a.parser.parse(a.testStep.testContext.id,a.isolated.message.content);b.then(function(b){a.tLoading=!1,a.loadMessageObject(b)},function(b){a.tLoading=!1,a.tError=b,a.loadMessageObject([])})}else a.loadMessageObject([]),a.tError=null,a.tLoading=!1}catch(c){a.tLoading=!1,a.tError=c}},a.onNodeSelect=function(b){var c=a.treeService.getEndIndex(b,a.isolated.message.content);a.isolated.cursor.init(b.data.lineNumber,b.data.startIndex-1,c-1,b.data.startIndex-1,!1),a.editorService.select(a.editor,a.isolated.cursor)},a.execute=function(){a.error=null,a.tError=null,a.mError=null,a.vError=null,a.isolated.message.content=a.isolated.editor.instance.doc.getValue(),a.validateMessage(),a.parseMessage()},a.init=function(){a.vLoading=!1,a.tLoading=!1,a.mLoading=!1,a.error=null,a.tError=null,a.mError=null,a.vError=null,a.initCodemirror(),a.loadValidationResult(null),a.$on("isolated:refreshEditor",function(){a.refreshEditor()}),a.$on("isolated:clearEditor",function(){a.clearMessage()}),h.$on("isolated:reportLoaded",function(b,c){null!=a.testStep&&j.setValidationReport(a.testStep,c)}),h.$on("isolated:testStepLoaded",function(b,c){a.refreshEditor(),a.testStep=c,a.validator=i.getMessageValidator(a.testStep.testContext.format),a.parser=i.getMessageParser(a.testStep.testContext.format),a.editorService=i.getEditorService(a.testStep.testContext.format),a.treeService=i.getTreeService(a.testStep.testContext.format),a.cursorService=i.getCursorService(a.testStep.testContext.format),a.loadMessage()}),h.$on("isolated:removeTestStep",function(){a.testStep=null}),h.$on("isolated:setEditorContent",function(b,c){a.refreshEditor(),a.nodelay=!0;var d=null==c?"":c;a.editor.doc.setValue(d),a.isolated.message.id=null,a.isolated.message.name="",a.execute()})}}]),angular.module("isolated").controller("IsolatedSystemReportCtrl",["$scope","$sce","$http","IsolatedSystem",function(a,b,c,d){a.isolated=d}]),angular.module("isolated").controller("IsolatedSystemVocabularyCtrl",["$scope","IsolatedSystem",function(a,b){a.isolated=b}]),angular.module("isolated").controller("IsolatedSystemProfileViewerCtrl",["$scope","IsolatedSystem",function(a,b){a.isolated=b}]),angular.module("tool").controller("ContactCtrl",["$scope","ContactLoader","ContactListLoader",function(a,b,c){a.init=function(){var b=new c;return b.then(function(b){a.contacts=b},function(b){a.error=b}),b}}]),angular.module("tool").controller("AboutCtrl",["$scope","AppInfo",function(){}]),angular.module("tool").controller("HeaderCtrl",["$scope","$location",function(){}]),angular.module("connectivity").controller("ConnectivityTestingCtrl",["$scope","Connectivity","$rootScope","StorageService",function(a,b,c,d){a.init=function(){var a=d.get(d.ACTIVE_SUB_TAB_KEY);(null==a||"/connectivity_execution"!=a)&&(a="/connectivity_testcase"),c.setSubActive(a)},c.$on("conn:testCaseLoaded",function(a,b){c.setSubActive(b&&null!=b?b:"/connectivity_execution")})}]),angular.module("connectivity").controller("ConnectivityTestCaseCtrl",["$scope","Connectivity","$rootScope","ConnectivityTestCaseListLoader","$cookies","$timeout","StorageService","TestCaseService",function(a,b,c,d,e,f,g,h){a.connectivity=b,a.loading=!0,a.error=null,a.testCases=[],a.tree={},a.testCase=b.testCase,a.selectedTestCase=b.selectedTestCase;var i=new h;a.selectTestCase=function(b){f(function(){a.selectedTestCase=b,g.set(g.SOAP_CONN_SELECTED_TESTCASE_ID_KEY,b.id),g.set(g.SOAP_CONN_SELECTED_TESTCASE_TYPE_KEY,b.type),f(function(){c.$broadcast("conn:testCaseSelected")})})},a.init=function(){a.error=null,a.loading=!0,a.testCases=[];var b=new d;b.then(function(b){a.testCases=b,a.tree.build_all(a.testCases);var c=null,d=g.get(g.SOAP_CONN_SELECTED_TESTCASE_ID_KEY),e=g.get(g.SOAP_CONN_SELECTED_TESTCASE_TYPE_KEY);if(null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var h=i.findOneByIdAndType(d,e,a.testCases[f]);if(null!=h){c=h;break}}null!=c&&(a.selectTestCase(c),a.selectNode(d,e))}if(c=null,d=g.get(g.SOAP_CONN_LOADED_TESTCASE_ID_KEY),e=g.get(g.SOAP_CONN_LOADED_TESTCASE_TYPE_KEY),null!=d&&null!=e){for(var f=0;f<a.testCases.length;f++){var h=i.findOneByIdAndType(d,e,a.testCases[f]);if(null!=h){c=h;break}}if(null!=c){var j=g.get(g.ACTIVE_SUB_TAB_KEY);a.loadTestCase(c,j)}}a.loading=!1,a.error=null},function(){a.error="Sorry, Failed to fetch the test cases. Please refresh page and try again.",a.loading=!1})},a.loadTestCase=function(d,e){b.testCase=d,a.testCase=b.testCase;var h=g.get(g.SOAP_CONN_LOADED_TESTCASE_ID_KEY),i=g.get(g.SOAP_CONN_LOADED_TESTCASE_TYPE_KEY);(h!=a.testCase.id||i!=a.testCase.type)&&(g.set(g.SOAP_CONN_LOADED_TESTCASE_ID_KEY,a.testCase.id),g.set(g.SOAP_CONN_LOADED_TESTCASE_TYPE_KEY,a.testCase.type),g.remove(g.SOAP_CONN_REQ_EDITOR_CONTENT_KEY),g.remove(g.SOAP_CONN_RESP_EDITOR_CONTENT_KEY)),f(function(){c.$broadcast("conn:testCaseLoaded",e)})},a.isSelectable=function(){return!0},a.selectNode=function(b,c){f(function(){i.selectNodeByIdAndType(a.tree,b,c)},0)}}]),angular.module("connectivity").controller("ConnectivityExecutionCtrl",["$scope","$timeout","$interval","Connectivity","$rootScope","$modal","Endpoint","$cookies","StorageService",function(a,b,c,d,e,f,g,h,i){a.logger=d.logger,a.loading=!1,a.testCase=d.testCase,a.selectedTestCase=d.selectedTestCase,a.loading=!1,a.connecting=!1,a.error=null,a.endpoint=null,a.user=d.user,a.hidePwd=!0,a.init=function(){e.$on("conn:testCaseLoaded",function(){a.testCase=d.testCase,a.logger.init(),a.loading=!0,a.error=null,a.connecting=!1}),d.user.init().then(function(){a.endpoint=a.user.endpoint},function(b){a.error=b})},a.log=function(b){a.logger.log(b)},a.isValidConfig=function(){return null!=a.user.receiverEndpoint&&""!=a.user.receiverEndpoint},a.openReceiverConfig=function(){a.logger.init();var b=f.open({templateUrl:"TransactionReceiver.html",controller:"ConnectivityReceiverCtrl",windowClass:"app-modal-window",resolve:{testCase:function(){return d.testCase},logger:function(){return d.logger},message:function(){return d.request.getContent()},user:function(){return d.user}}});b.result.then(function(b){null!=b.received&&a.triggerReqEvent(b.received),null!=b.sent&&a.triggerRespEvent(b.sent)},function(){a.triggerReqEvent(""),a.triggerRespEvent("")})},a.send=function(){a.logger.init();var b=f.open({templateUrl:"TransactionSender.html",controller:"ConnectivitySenderCtrl",size:"lg",backdrop:"static",resolve:{testCase:function(){return d.testCase},logger:function(){return d.logger},message:function(){return d.request.editor.getContent()},user:function(){return d.user}}});b.result.then(function(b){null!=b.sent&&a.triggerReqEvent(b.sent),null!=b.received&&a.triggerRespEvent(b.received)},function(){a.triggerRespEvent("")})},a.configureReceiver=function(){var b=f.open({templateUrl:"TransactionConfigureReceiver.html",controller:"ConnectivityConfigureReceiverCtrl"});b.result.then(function(b){b.save===!0&&(d.user.senderUsername=b.senderUsername,d.user.senderPassword=b.senderPassword,d.user.senderFacilityID=b.senderFacilityID,d.user.receiverUsername=b.receiverUsername,d.user.receiverPassword=b.receiverPassword,d.user.receiverFacilityId=b.receiverFacilityId,d.user.receiverEndpoint=b.receiverEndpoint,i.set(i.SOAP_COMM_RECEIVER_USERNAME_KEY,d.user.receiverUsername),i.set(i.SOAP_COMM_RECEIVER_PWD_KEY,d.user.receiverPassword),i.set(i.SOAP_COMM_RECEIVER_FACILITYID_KEY,d.user.receiverFacilityId),i.set(i.SOAP_COMM_RECEIVER_ENDPOINT_KEY,d.user.receiverEndpoint),a.triggerRespEvent(""),a.send())},function(){})},a.viewReceiver=function(){var b=f.open({templateUrl:"TransactionViewReceiverConfiguration.html",controller:"ConnectivityViewReceiverConfigurationCtrl",windowClass:"app-modal-window",resolve:{testCase:function(){return d.testCase},user:function(){return d.user}}});b.result.then(function(){a.triggerRespEvent("")},function(){a.triggerRespEvent("")})},a.hasRequestContent=function(){return null!=d.request.getContent()&&""!=d.request.getContent()},a.triggerReqEvent=function(a){b(function(){e.$broadcast("conn:reqMessage",a)})},a.triggerRespEvent=function(a){b(function(){e.$broadcast("conn:respMessage",a)})}}]),angular.module("connectivity").controller("ConnectivityReqCtrl",["$scope","$http","Connectivity","XmlFormatter","$window","XmlEditorUtils","$timeout","$rootScope","ConnectivityValidator","$modal","StorageService",function(a,b,c,d,e,f,g,h,i,j,k){a.eLoading=!1,a.vError=null,a.request=c.request,a.editor=null,a.request=c.request,a.validating=!1,a.editorInit=!1,a.serverEndpoint=c.serverEndpoint,a.user=c.user,a.request=c.request,a.rLoading=!1,a.rError=null,a.resized=!1,a.validationSettings=a.request.validationSettings,a.validationResult=a.request.validationResult,a.editor=a.request.editor,a.itemsByPage=10,a.errors=a.validationResult.errors,a.errorsCollection=[].concat(a.errors.data),a.affirmatives=a.validationResult.affirmatives,a.affirmativesCollection=[].concat(a.affirmatives.data),a.alerts=a.validationResult.alerts,a.alertsCollection=[].concat(a.alerts.data),a.ignores=a.validationResult.ignores,a.ignoresCollection=[].concat(a.ignores.data),a.warnings=a.validationResult.warnings,a.warningsCollection=[].concat(a.warnings.data),a.selectedExampleMessage={id:-1,content:""},a.error=null,a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.hasContent=function(){return""!=a.request.getContent()&&null!=a.request.getContent()},a.getMessageName=function(){return a.editor.message.name},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/soap/upload";c.submit().success(function(c){var d=angular.fromJson(c);a.request.editor.instance.doc.setValue(d.content),a.uploadError=null,a.fileName=b}).error(function(c,d,e){a.fileName=b,a.uploadError="Sorry, Failed to upload file: "+b+", Error: "+e}).complete(function(){})})}),a.validate=function(){a.vError=null;var b=a.request.editor.instance.doc.getValue();if(null!=b&&""!=b){a.validating=!0;var c=new d(b);c.then(function(b){a.validating=!1,a.reqMessage(b)},function(b){a.validating=!1,a.vError=b})}},a.clearMessage=function(){a.error=null,a.reqMessage("")},a.refreshEditor=function(){g(function(){void 0!=a.editor&&a.editor.refresh()},1e3)},a.saveMessage=function(){a.request.message.download()},a.resize=function(){},a.validateMessage=function(){if(a.refreshEditor(),a.rLoading=!0,a.rError=null,null!=a.testCase&&""!=a.request.getContent()){var b=(new i).validate(a.request.message.content,a.testCase.id,c.user.id,"req",null);b.then(function(b){a.rLoading=!1,a.setValidationResult(b)},function(b){a.rLoading=!1,a.rError=b,a.setValidationResult({})})}else a.setValidationResult({}),a.rLoading=!1,a.rError=null},a.setValidationResult=function(b){a.request.validationResult.init(b),a.validationResult=a.request.validationResult,a.errors=a.validationResult.errors,a.affirmatives=a.validationResult.affirmatives,a.alerts=a.validationResult.alerts,a.ignores=a.validationResult.ignores,a.warnings=a.validationResult.warnings},a.select=function(a){-1!=a.line&&c.request.cursor.setLine(a.line)},a.init=function(){a.error=null,a.loading=!0,a.editor=CodeMirror.fromTextArea(document.getElementById("connectivityReqTextArea"),{lineNumbers:!0,fixedGutter:!0,mode:"xml",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setOption("readOnly",!0),a.editor.setSize("100%",300),a.editor.on("dblclick",function(){a.$apply(function(){a.request.cursor.setLine(a.editor.doc.getCursor(!0).line+1)})}),a.request.editor.init(a.editor),h.$on("conn:testCaseLoaded",function(){a.testCase=c.testCase;var b="RECEIVER"==c.testCase.sutType?c.testCase.testContext.message:null!=k.get(k.SOAP_CONN_REQ_EDITOR_CONTENT_KEY)?k.get(k.SOAP_CONN_REQ_EDITOR_CONTENT_KEY):"";a.reqMessage(b)}),h.$on("conn:reqMessage",function(b,c){a.reqMessage(c)}),a.$watch(function(){return a.request.cursor.updateIndicator},function(){f.select(a.request.cursor,a.request.editor.instance)},!0),a.setValidationResult({}),a.refreshEditor()},a.reqMessage=function(b){a.request.message.content=b,a.editor.doc.setValue(b),k.set(k.SOAP_CONN_REQ_EDITOR_CONTENT_KEY,b),a.validateMessage()},a.triggerRespEvent=function(a){h.$broadcast("conn:respMessage",a)}}]),angular.module("connectivity").controller("ConnectivityReqReportCtrl",["$scope","$sce","$http","SoapValidationReportGenerator","SoapValidationReportDownloader","Connectivity","$rootScope",function(a,b,c,d,e,f,g){a.connectivityReqHtmlReport=null,a.error=null,a.loading=!1,a.testCase=f.testCase,a.validationResult=f.validationResult,a.init=function(){g.$on("conn:testCaseLoaded",function(){a.testCase=f.testCase}),a.$watch(function(){return a.validationResult.xml},function(b){if(null!=b&&""!=b){a.loading=!0;var c=new d(b,"html");c.then(function(b){a.connectivityReqHtmlReport=b.htmlReport,a.loading=!1,a.error=null},function(b){a.error=b,a.loading=!1,a.connectivityReqHtmlReport=null})}else a.loading=!1,a.connectivityReqHtmlReport=null,a.error=null},!0)},a.downloadAs=function(b){e.downloadAs(a.validationResult.xml,b)}}]),angular.module("connectivity").controller("ConnectivityConfigureReceiverCtrl",["$scope","$sce","$http","Connectivity","$rootScope","$modalInstance",function(a,b,c,d,e,f){a.testCase=d.testCase,a.user=angular.copy(d.user),a.user.save=!1,a.send=function(){a.user.save=!0,f.close(a.user)},a.cancel=function(){f.dismiss("cancel")}}]),angular.module("connectivity").controller("ConnectivityViewReceiverConfigurationCtrl",["$scope","$sce","$http","Connectivity","$rootScope","$modalInstance","testCase","user",function(a,b,c,d,e,f){a.testCase=d.testCase,a.user=d.user,a.close=function(){f.close()},a.cancel=function(){f.dismiss("cancel")},a.hasRequestContent=function(){return null!=a.message&&""!=a.message}}]),angular.module("connectivity").controller("ConnectivitySenderCtrl",["$scope","$sce","$http","Connectivity","$rootScope","$modalInstance","testCase","ConnectivityInitiator","message","user","logger",function(a,b,c,d,e,f,g,h,i,j,k){a.testCase=g,a.message=i,a.user=j,a.logger=k,a.sent=null,a.received=null,a.connecting=!1,a.error=null,a.isValidConfig=function(){return null!=a.user.receiverEndpoint&&""!=a.user.receiverEndpoint},a.close=function(){f.close({sent:a.sent,received:a.received})},a.cancel=function(){f.dismiss("cancel")},a.hasRequestContent=function(){return null!=a.message&&""!=a.message},a.send=function(){if(a.error=null,""!=a.user.receiverEndpoint&&a.hasRequestContent()){a.connecting=!0,a.logger.init(),a.received="",a.logger.log("Sending request ========================>");var b=(new h).send(a.user,a.testCase.id,a.message);b.then(function(b){var c=b.incoming,d=b.outgoing;a.logger.log("Outgoing message sent successfully."),a.logger.log("Outgoing message is:"),a.logger.log(d),a.logger.log("Incoming message received <========================"),a.logger.log("Incoming message is:"),a.logger.log(c),a.logger.log("Transaction completed"),a.connecting=!1,a.sent=d,a.received=c},function(b){a.connecting=!1,a.error=b.data,a.logger.log("Error: "+b.data),a.logger.log("Transaction aborted"),e.$broadcast("conn:respMessage",""),a.received=""})}else a.error="No outgoing message found"},a.send()}]),angular.module("connectivity").controller("ConnectivityRespCtrl",["$scope","$http","Connectivity","$window","XmlFormatter","XmlEditorUtils","$timeout","$rootScope","ConnectivityValidator","$modal","StorageService",function(a,b,c,d,e,f,g,h,i,j,k){a.testCase=c.testCase,a.response=c.response,a.selectedTestCase=c.selectedTestCase,a.loading=!0,a.error=null,a.eLoading=!1,a.validating=!1,a.editorInit=!1,a.rLoading=!1,a.rError=null,a.resized=!1,a.validationSettings=c.response.validationSettings,a.validationResult=c.response.validationResult,a.itemsByPage=10,a.errors=a.validationResult.errors,a.errorsCollection=[].concat(a.errors.data),a.affirmatives=a.validationResult.affirmatives,a.affirmativesCollection=[].concat(a.affirmatives.data),a.alerts=a.validationResult.alerts,a.alertsCollection=[].concat(a.alerts.data),a.ignores=a.validationResult.ignores,a.ignoresCollection=[].concat(a.ignores.data),a.warnings=a.validationResult.warnings,a.warningsCollection=[].concat(a.warnings.data),a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.error=null,a.init=function(){a.error=null,a.testCases=[],a.loading=!0,a.editor=CodeMirror.fromTextArea(document.getElementById("connectivityRespTextArea"),{lineNumbers:!0,fixedGutter:!0,mode:"xml",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setOption("readOnly",!0),a.editor.setSize("100%",300),a.editor.on("dblclick",function(){a.$apply(function(){a.response.cursor.setLine(a.editor.doc.getCursor(!0).line+1)
}),event.preventDefault()}),a.response.editor.init(a.editor),a.$watch(function(){return a.response.cursor.updateIndicator},function(){f.select(a.response.cursor,a.editor)},!0),h.$on("conn:testCaseLoaded",function(){a.testCase=c.testCase,a.refreshEditor();var b=k.get(k.SOAP_CONN_RESP_EDITOR_CONTENT_KEY);a.respMessage(null!=b?b:"")}),h.$on("conn:respMessage",function(b,c){a.respMessage(c)}),a.setValidationResult({}),a.refreshEditor()},a.respMessage=function(b){a.response.message.content=b,a.editor.doc.setValue(b),k.set(k.SOAP_CONN_RESP_EDITOR_CONTENT_KEY,b),a.refreshEditor(),a.validateMessage()},a.triggerReqEvent=function(a){h.$broadcast("conn:reqMessage",a)},a.triggerRespEvent=function(a){h.$broadcast("conn:respMessage",a)},a.hasContent=function(){return""!=a.response.getContent()&&null!=a.response.getContent()},a.getMessageName=function(){return a.response.message.name},a.clearMessage=function(){a.error=null,a.respMessage("")},a.refreshEditor=function(){void 0!=a.editor&&g(function(){a.editor.refresh()},1e3)},a.saveMessage=function(){a.response.message.download()},a.validate=function(){a.error=null;var b=a.response.editor.instance.doc.getValue();if(null!=b&&""!=b){a.validating=!0;var c=new e(b);c.then(function(b){a.validating=!1,a.respMessage(b)},function(b){a.validating=!1,a.error=b})}},a.resize=function(){},a.validateMessage=function(){if(a.rLoading=!0,a.rError=null,null!=c.testCase&&""!=c.response.getContent()){var b=(new i).validate(a.response.message.content,c.testCase.id,c.user.id,"resp",c.request.getContent());b.then(function(b){a.rLoading=!1,a.setValidationResult(b)},function(b){a.rLoading=!1,a.rError=b,a.setValidationResult({})})}else a.setValidationResult({}),a.rLoading=!1,a.rError=null},a.setValidationResult=function(b){a.response.validationResult.init(b),a.validationResult=a.response.validationResult,a.errors=a.validationResult.errors,a.affirmatives=a.validationResult.affirmatives,a.alerts=a.validationResult.alerts,a.ignores=a.validationResult.ignores,a.warnings=a.validationResult.warnings},a.select=function(a){-1!=a.line&&c.response.cursor.setLine(a.line)}}]),angular.module("connectivity").controller("ConnectivityRespReportCtrl",["$scope","$sce","$http","SoapValidationReportGenerator","SoapValidationReportDownloader","Connectivity",function(a,b,c,d,e,f){a.connectivityRespHtmlReport=null,a.error=null,a.loading=!1,a.testCase=f.testCase,a.init=function(){a.$watch(function(){return f.response.validationResult.xml},function(c){if(null!=c&&""!=c){a.loading=!0;var e=new d(c,"html");e.then(function(c){a.connectivityRespHtmlReport=b.trustAsHtml(c.htmlReport),a.loading=!1,a.error=null},function(b){a.error=b,a.loading=!1,a.connectivityRespHtmlReport=null})}else a.loading=!1,a.connectivityRespHtmlReport=null,a.error=null},!0)},a.downloadAs=function(a){e.downloadAs(f.response.validationResult.xml,a)}}]),angular.module("connectivity").controller("ConnectivityReceiverCtrl",["$scope","$sce","$http","Connectivity","$rootScope","$modalInstance","testCase","logger","ConnectivityClock","message",function(a,b,c,d,e,f,g,h,i,j){a.testCase=g,a.user=d.user,a.logger=h,a.endpoint=a.user.endpoint,a.message=j,a.sent=null,a.received=null,a.connecting=!1,a.error=null,a.counterMax=30,a.counter=0,a.listenerReady=!1,a.warning=null,a.log=function(b){a.logger.log(b)},a.close=function(){f.close({sent:a.sent,received:a.received})},a.cancel=function(){f.dismiss("cancel")},a.hasRequestContent=function(){return null!=a.message&&""!=a.message},a.stop=function(){a.connecting=!1,a.counter=a.counterMax,i.stop(),a.log("Stopping transaction. Please wait...."),a.user.transaction.closeConnection().then(function(){a.log("Transaction stopped.")},function(){})},a.start=function(){a.logger.clear(),a.counter=0,a.connecting=!0,a.received="",a.sent="",a.error=null,a.warning=null,a.log("Configuring connection. Please wait..."),d.user.transaction.openConnection().then(function(){a.log("Connection configured.");var b=function(){++a.counter,a.log("Waiting for incoming message....Elapsed time(second):"+a.counter+"s"),a.user.transaction.messages().then(function(){var b=a.user.transaction.incoming,c=a.user.transaction.outgoing;a.counter<a.counterMax?(null!=b&&""!=b&&""==a.received&&(a.log("Incoming Message Received <--------------------------------------"),a.log(b),a.received=b),null!=c&&""!=c&&""==a.sent&&(a.log("Outgoing Message Sent:    -------------------------------------->"),a.log(c),a.sent=c),""!=a.received&&""!=a.sent&&a.stop()):(null==b||""==b?(a.warning="We did not receive any incoming message after 30s. <p>Possible cause (1): You are using wrong credentials. Please check the credentials in your outbound SOAP Envelope against those created for your system.</p>  <p>Possible cause (2):The SOAP endpoint address may be incorrect.   Verify that you are using the correct SOAP endpoint address that is displayed by the tool.</p><p>Possible cause (3):The HTTP header field Content-Type  may not be set correctly for use with SOAP 1.2.   SOAP 1.2 requires application/soap+xml, and SOAP 1.2 requires text/xml.  The NIST Tool follows SOAP 1.2, which is required by section 2 of the 'CDC Transport Layer Protocol Recommendation V1.1' (http://www.cdc.gov/vaccines/programs/iis/technical-guidance/SOAP/downloads/transport-specification.pdf)</p>",a.log("We did not receive any incoming message after 30s")):(null==c||""==c)&&a.log("We were unable to send the response after 30s"),a.stop())},function(b){a.error=b,a.log("Error: "+b),a.received="",a.sent="",a.stop()})};i.start(b)},function(b){a.log("Failed to configure incoming connection: Error: "+b),a.log("Transaction aborted"),a.connecting=!1,a.error=b})}}]),angular.module("hit-tool-directives").directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}]),angular.module("hit-tool-directives").directive("stRatio",function(){return{link:function(a,b,c){var d=+c.stRatio;b.css("width",d+"%")}}}),angular.module("hit-tool-directives").directive("csSelect",function(){return{require:"^stTable",template:"",scope:{row:"=csSelect"},link:function(a,b,c,d){b.bind("change",function(){a.$apply(function(){d.select(a.row,"single")})}),a.$watch("row.isSelected",function(a){a===!0?b.parent().addClass("st-selected"):b.parent().removeClass("st-selected")})}}}),angular.module("hit-tool-directives").directive("mypopover",["$compile","$templateCache",function(a,b){return{restrict:"A",link:function(a,c){var d=b.get("profileInfo.html"),e={content:d,placement:"bottom",html:!0};$(c).popover(e)}}}]);