<div ng-controller="IsolatedSystemExecutionCtrl" ng-init="init()">
<div style="margin-left:10px;margin-right:10px;">
<div class="row">
    <div class="col-md-12">
        <ol class="breadcrumb" ng-show="testCase != null" style="font-weight: bold">
            <li>{{testCase.parentName}}</li>
            <li> {{testCase.name}}</li>
        </ol>
        <div ng-show="testCase != null">
          <span class="pull-right">
        <button type="button" ng-click="resetTestCase()"
                title="Restart" class="btn btn-sm btn-danger">
            <i class="fa fa-refresh"></i>
            Restart
        </button>

    </span>
            <!--<hr/>-->
        </div>
        <div ng-show="testCase == null">No Test Case Loaded.</div>
    </div>
</div>
<div class="row">
    <div class="col-md-10">
        <div class="panel panel-info" style="margin:10px; width:400px" ng-show="testCase != null">
            <div class="panel-heading">
                <span>Test Result</span>
            </div>
            <div class="panel-body">
                <table class="table table-bordered">
                    <tr>
                        <td>Test Status</td>
                        <td>{{testCase.executionStatus === 'COMPLETE' ? 'Completed':'In Progress'}}</td>
                    </tr>
                    <tr>
                        <td>Test Result</td>
                        <td>
                <span ng-show="testCase.executionStatus === 'COMPLETE'">
                    <span ng-show="isTestCaseSuccessful()">
                         <i title="Complete"
                            class="glyphicon glyphicon-ok green"></i> Passed
                    </span>
                    <span ng-show="!isTestCaseSuccessful()">
                             <i title="Message is Invalid"
                                class="glyphicon glyphicon-remove red"></i>Failed
                    </span>
                </span>
                <span ng-show="testCase.executionStatus !== 'COMPLETE'">
                 </span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-10">
        <div class="panel panel-info" style="margin:10px" ng-show="testCase != null">
            <div class="panel-heading">
                <div ng-click="testStepListCollapsed = !testStepListCollapsed">
                    <i class="fa fa-caret-down" ng-show="!testStepListCollapsed"></i>
                    <i class="fa fa-caret-right" ng-show="testStepListCollapsed"></i>
                    <span ng-show="testCase.executionStatus !== 'COMPLETE'">Test Steps Execution</span>
                    <span ng-show="testCase.executionStatus === 'COMPLETE'">Test Steps Result</span>
                </div>
            </div>
            <div class="panel-body">
                <div collapse="testStepListCollapsed">
                    <table
                            class="table table-striped table-bordered">
                        <thead>
                        <tr class="tbl-header">
                            <th>Type</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th style="width:100px">Execution Status</th>
                            <th style="width:100px">Validation Result</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-class="{'warning': testCase.executionStatus !== 'COMPLETE' && testStep != null && row.id === testStep.id, 'danger':testCase.executionStatus === 'COMPLETE' && !testStepSucceed(row), 'success': testCase.executionStatus === 'COMPLETE' && testStepSucceed(row)}"
                            ng-repeat="row in testCase.children | orderBy:'position'">
                            <td>
                                <label>
                                    <span ng-show="row.connectionType === 'TA_MANUAL' || row.connectionType === 'SUT_MANUAL'">
                       <i class="fa fa-check-square-o"></i>
                    </span>

                    <span ng-show="row.connectionType === 'TA_INITIATOR' || row.connectionType === 'SUT_INITIATOR'">
                        <i class="fa fa-arrow-right"></i>
                    </span>

                    <span ng-show="row.connectionType === 'TA_RESPONDER' || row.connectionType === 'SUT_RESPONDER'">
                        <i class="fa fa-arrow-left"></i>
                    </span>
                                    <input ng-show="isTestCaseCompleted()" type="radio"
                                           ng-click="selectTestStep(row)"
                                           ng-checked="testStep != null && testStep.id === row.id"
                                            >
                                </label>
                            </td>
                            <td>

                                {{row.position}}. {{row.name}}
                            </td>
                            <td ng-bind-html="row.description"></td>
                            <td style="width:100px">
                    <span>
                    <span ng-show="getExecutionStatus(row) === undefined">Not started</span>
                          <span ng-show="getExecutionStatus(row) === 'IN_PROGRESS'">
                                       <i title="In Progress"
                                          class="glyphicon glyphicon-ok"></i> In Progress
                             </span>
                            <span ng-show="getExecutionStatus(row) === 'COMPLETE'">
                                     <i title="Complete"
                                        class="glyphicon glyphicon-ok green"></i> Completed
                             </span>
                        </span>
                            </td>
                            <td style="width:100px">
                    <span ng-show="row.connectionType != 'TA_MANUAL' && row.connectionType != 'SUT_MANUAL'">
                    <span ng-show="getValidationStatus(row) < 0 && row.id !== testStep.id">Not started</span>
                        <span ng-show="getValidationStatus(row) < 0 && row.id === testStep.id">
                              In Progress
                        </span>
                    <span ng-show="getValidationStatus(row) > 0">
                              <i title="Message is Invalid"
                                 class="glyphicon glyphicon-remove red"></i> Failed
                          </span>
                            <span ng-show="getValidationStatus(row) == 0">
                                      <i title="Message Is Valid"
                                         class="glyphicon glyphicon-ok green"></i> Passed
                             </span>
                        </span>
                     <span ng-show="row.connectionType == 'TA_MANUAL' || row.connectionType == 'SUT_MANUAL'">
                        N/A
                    </span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<div ng-show="testStep !== null" style="margin:10px">
<div class="row">
    <div class="col-md-10">
        <div ng-show="testCase != null">
            <span style="font-size: 18px; font-weight: bold">{{testStep.position}}. Test Step: {{testStep.name}}</span>

    <span class="pull-right">

            <!--<button ng-show="testStep.connectionType === 'TA_INITIATOR' && !isTestCaseCompleted()" type="button"-->
                    <!--class="btn btn-sm btn-primary" ng-click="configCollapsed = !configCollapsed"><i-->
                    <!--class="fa fa-cog"></i> Configure-->
            <!--</button>-->

            <!--<button ng-show="testStep.connectionType === 'TA_INITIATOR' && !isTestCaseCompleted()" type="button"-->
                    <!--ng-click="send()" ng-disabled="!isValidConfig() || connecting"-->
                    <!--title="Send" class="btn btn-sm btn-success">-->
                <!--<i class="fa fa-arrow-right"></i>-->
                <!--Send-->
            <!--</button>-->

              <!--<button title="Transaction Details" ng-show="testStep.connectionType === 'SUT_INITIATOR' && !isTestCaseCompleted()" type="button"-->
                      <!--class="btn btn-sm btn-primary" ng-click="configCollapsed = !configCollapsed"><i-->
                      <!--class="fa fa-cog"></i>Settings-->
              <!--</button>-->

             <!--<button ng-show="testStep.connectionType === 'SUT_INITIATOR' && !isTestCaseCompleted()" type="button"-->
                     <!--ng-click="startListening()" ng-disabled="senderForm.$invalid || connecting"-->
                     <!--title="Start listening"-->
                     <!--class="btn btn-sm btn-success">-->
                 <!--<i class="fa fa-play"></i>-->
                 <!--Start-->
             <!--</button>-->
             <!--<button ng-show="testStep.connectionType === 'SUT_INITIATOR' && !isTestCaseCompleted()" type="button"-->
                     <!--ng-disabled="!connecting" ng-click="stopListening()"-->
                     <!--class="btn btn-sm btn-warning"><i class="fa fa-stop"></i>-->
                 <!--Stop-->
             <!--</button>-->

        <button type="button" ng-click="executeNextTestStep(testStep)"
                ng-show="!isTestCaseCompleted() && isTestStepCompleted(testStep)"
                title="Execute Next Step" class="btn btn-sm btn-success">
            <span ng-show="isLastStep(testStep)"><i class="fa fa-check"></i> Complete</span>
            <span ng-show="!isLastStep(testStep)"><i class="fa fa-arrow-right"></i> Next</span>
        </button>
    </span>
            <hr/>
        </div>
    </div>
</div>
<!--<div class="panel panel-info" >-->
<!--&lt;!&ndash; Default panel contents &ndash;&gt;-->
<!--<div class="panel-heading"></div>-->
<!--<div class="panel-body">-->
<div class="row">
    <div class="col-md-10">
        <div ng-show="error != null">
            <div style="padding-top: 10px;padding-bottom:10px">
                <div class="alert alert-danger" role="alert" ng-bind="error"></div>
            </div>
        </div>

        <div ng-show="warning != null">
            <div style="padding-top: 10px;padding-bottom:10px">
                <div class="alert alert-info" role="alert" ng-bind-html="toHTML(warning)"></div>
            </div>
        </div>
    </div>
</div>


<div ng-show="testStep.connectionType === 'TA_INITIATOR' && !isTestCaseCompleted()">
    <button type="button"
            class="btn btn-sm btn-primary" ng-click="configCollapsed = !configCollapsed"><i
            class="fa fa-cog"></i> Configure
    </button>

    <button type="button"
            ng-click="send()" ng-disabled="!isValidConfig() || connecting"
            title="Send" class="btn btn-sm btn-success">
        <i class="fa fa-arrow-right"></i>
        Send
    </button>

     <span ng-show="connecting">
            <i class="fa fa-spinner"></i> Remaining time (s): {{counter}} / {{counterMax}}
        </span>

    <div class="row" collapse="configCollapsed">
        <div class="col-md-5">
            <fieldset>
                <legend>Please provide receiver's system information</legend>
                <!--<div class="page-header">-->
                <!--<h4></h4>-->
                <!--</div>-->
                <form name="receiverForm1" novalidate>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" class="form-control" ng-model="user.receiverUsername"
                               placeholder="Username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="text" class="form-control"
                               placeholder="Password"
                               ng-model="user.receiverPassword">
                    </div>
                    <div class="form-group">
                        <label>FacilityID</label>
                        <input type="text" class="form-control" placeholder="Facility Id"
                               ng-model="user.receiverFacilityId">
                    </div>
                    <div class="form-group"
                         ng-class="{ 'has-error' : receiverForm1.endpoint.$invalid && !receiverForm1.endpoint.$pristine }">
                        <label>Endpoint</label>
                        <input type="url" name="endpoint" class="form-control" ng-model="user.receiverEndpoint"
                               placeholder="SUT Endpoint" required>

                        <p ng-show="receiverForm1.endpoint.$invalid && !receiverForm1.endpoint.$pristine"
                           class="help-block">
                            Invalid url. Expected format is {{appInfo.url}}</p>
                    </div>
                </form>

                <!--<button title="Send Outgoing Message" type="button" class="btn btn-xs btn-primary"-->
                <!--ng-disabled="!isValidConfig()"-->
                <!--ng-click="send()">-->
                <!--<i class="fa fa fa-arrow-right"></i> Send-->
                <!--</button>-->

            </fieldset>
        </div>


        <div class="col-md-5">
            <fieldset>
                <legend>Console</legend>
                <textarea class="well" wrap="off"
                          style="overflow: auto; margin-top:23px;font-size: 11px; width: 100%; height: 100%"
                          rows="13"
                          disabled
                          ng-model="logger.content"></textarea>
            </fieldset>
        </div>
    </div>
</div>

<div ng-show="testStep.connectionType === 'SUT_INITIATOR' && !isTestCaseCompleted()">
    <div class="" style="margin-bottom: 20px">
        <button title="Transaction Details" type="button"
                class="btn btn-sm btn-primary" ng-click="configCollapsed = !configCollapsed"><i
                class="fa fa-cog"></i>Transaction Details
        </button>

        <button type="button"
                ng-click="startListening()" ng-disabled="senderForm.$invalid || connecting"
                title="Start listening"
                class="btn btn-sm btn-success">
            <i class="fa fa-play"></i>
            Start
        </button>
        <button type="button"
                ng-disabled="!connecting" ng-click="stopListening()"
                class="btn btn-sm btn-warning"><i class="fa fa-stop"></i>
            Stop
        </button>
    <span ng-show="connecting">
            <i class="fa fa-spinner"></i> Remaining time (s): {{counter}} / {{counterMax}}
        </span>
    </div>

    <div class="row" collapse="configCollapsed">

        <div class="col-md-5">
            <fieldset>
                <legend>Configuration Information</legend>
                <form name="senderForm" novalidate>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" disabled name="u" class="form-control"
                               ng-model="user.senderUsername">

                        <p class="help-block">This is the username assigned to you to use in your message</p>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <input type="text" class="form-control" name="p"
                               ng-model="user.senderPassword" disabled>

                        <p class="help-block">This is the password assigned to you to use in your message</p>
                    </div>

                    <div class="form-group">
                        <label>FacilityID</label>
                        <input type="text" class="form-control" name="facilityId"
                               ng-model="user.senderFacilityID" disabled>

                        <p class="help-block">This is the facilityID assigned to you to use in your message</p>
                    </div>

                    <div class="form-group"
                            >
                        <label>Endpoint</label>
                        <!--<input type="url" name="endpoint" class="form-control" ng-model="endpoint.value"-->
                        <!--placeholder="SUT Endpoint" required disabled>-->
                        <span name="endpoint" class="form-control">{{endpoint.value}}</span>
                        <!--<p ng-show="senderForm.endpoint.$invalid && !senderForm.endpoint.$pristine" class="help-block">-->
                        <!--Sorry, an-->
                        <!--error occured. Please refresh your page</p>-->
                    </div>

                    <div class="form-group"
                            >
                        <label>WSDL</label>
                        <a ng-href="{{endpoint.value}}.wsdl" class="form-control" target="_blank">{{endpoint.value}}.wsdl</a>
                        <!--<p ng-show="senderForm.endpoint.$invalid && !senderForm.endpoint.$pristine" class="help-block">-->
                        <!--Sorry, an-->
                        <!--error occured. Please refresh your page</p>-->
                    </div>

                </form>
                <!--<button title="Send Outgoing Message" type="button" class="btn btn-xs btn-primary"-->
                <!--ng-disabled="!isValidConfig()"-->
                <!--ng-click="send()">-->
                <!--<i class="fa fa fa-arrow-right"></i> Send-->
                <!--</button>-->

            </fieldset>
        </div>
        <div class="col-md-5">
            <fieldset>
                <legend>Console</legend>
                <textarea class="well" wrap="off"
                          style="overflow: auto; margin-top:23px;font-size: 11px; width: 100%; height: 100%"
                          rows="23"
                          disabled
                          ng-model="logger.content"></textarea>
            </fieldset>
        </div>
    </div>
</div>

<div class="row" ng-show="testStep.connectionType === 'TA_MANUAL' || testStep.connectionType === 'SUT_MANUAL'">
    <div class="col-md-10">
        <div class="panel panel-info">
            <!-- Default panel contents -->
            <div class="panel-heading">
                Instruction
            </div>
            <div class="panel-body">
                <div ng-bind="testStep.description"></div>
                <br/>
            </div>
        </div>
    </div>
</div>

<div style="padding-top:10px"
     ng-show="testStep.connectionType === 'TA_INITIATOR' || testStep.connectionType === 'SUT_INITIATOR' || testStep.connectionType === 'TA_RESPONDER' || testStep.connectionType === 'SUT_RESPONDER'">
    <div>
        <tabset>
            <tab select="setActiveTab(0)" active="tabs[0]">
                <tab-heading>
                    <i class="fa fa-check-circle"></i>Validation
                </tab-heading>
                <div ng-include="'views/isolated/validation.html'"></div>
            </tab>

            <tab>
                <tab-heading>
                    <i class="fa fa-file-o"></i>Report
                </tab-heading>

                <div ng-include="'views/isolated/report.html'"></div>
            </tab>

            <tab>
                <tab-heading>
                    <i class="fa fa-th-list"></i>Profile Viewer
                </tab-heading>
                <div ng-include="'views/isolated/profileViewer.html'"></div>
            </tab>
            <tab>
                <tab-heading>
                    <i class="fa fa-book"></i>Vocabulary
                </tab-heading>
                <div ng-include="'views/isolated/vocabulary.html'"></div>
            </tab>

            <tab ng-show="testStep.jurorDocument && testStep.jurorDocument != null">
                <tab-heading>
                    <i class="fa fa-check-circle"></i>Juror Document
                </tab-heading>
                <div class="panel panel-info">
                    <div class="panel-body">
                <div class="pull-right">
                    <!--<button title="Download Juror Document" type="button" class="btn btn-sm btn-primary"-->
                            <!--ng-click="downloadJurorDoc('isolated_jurordoc',testStep.name)">-->
                        <!--<i class="fa fa-download"></i> PDF-->
                    <!--</button>-->
                    <button title="Download Juror Document" type="button" class="btn btn-sm btn-primary"
                            ng-click="downloadTestArtifact(testStep.jurorDocument.pdfPath)">
                        <i class="fa fa-download"></i> PDF
                    </button>

                </div>
                <br/>
                <br/>
                <div class="testcase-content" id="isolated_jurordoc">
                    <div compile="testStep.jurorDocument.html"/>
                </div>
                </div>
                </div>
            </tab>

        </tabset>
    </div>
</div>
</div>
<!--</div>-->
<!--</div>-->
<!--</div>-->
<div ng-show="testStep === null">
    <!--No Test Step In Progress-->
</div>
</div>
</div>
